<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Qualification Planner Builder</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
        }
        .tab-btn {
            padding: 10px 20px;
            background: #e0e0e0;
            border: none;
            cursor: pointer;
            margin-right: 5px;
        }
        .tab-btn.active {
            background: #3498db;
            color: white;
        }
        .tab-content {
            display: none;
            padding: 20px;
            border: 1px solid #ddd;
            border-top: none;
        }
        .tab-content.active {
            display: block;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
        }
        th {
            background-color: #3498db;
            color: white;
        }
        #generatedCode {
            width: 100%;
            height: 300px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Qualification Planner Builder</h1>
        
        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('qualification')">Qualification</button>
            <button class="tab-btn" onclick="showTab('groups')">Groups</button>
            <button class="tab-btn" onclick="showTab('units')">Units</button>
            <button class="tab-btn" onclick="showTab('rules')">Rules</button>
            <button class="tab-btn" onclick="showTab('export')">Generate</button>
        </div>
        
        <div id="qualification" class="tab-content active">
            <h2>Qualification Details</h2>
            <label>Title: <input type="text" id="qualTitle"></label><br>
            <label>Code: <input type="text" id="qualCode"></label><br>
            <label>Default Duration: <input type="number" id="defaultDuration" value="6"> weeks</label>
        </div>
        
        <div id="groups" class="tab-content">
            <h2>Unit Groups</h2>
            <button onclick="addGroup()">Add Group</button>
            <table id="groupsTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Min</th>
                        <th>Max</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        
        <div id="units" class="tab-content">
            <h2>Units</h2>
            <button onclick="addUnit()">Add Unit</button>
            <table id="unitsTable">
                <thead>
                    <tr>
                        <th>Code</th>
                        <th>Name</th>
                        <th>Groups</th>
                        <th>Duration</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        
        <div id="rules" class="tab-content">
            <h2>Packaging Rules</h2>
            <div>
                <label><input type="checkbox" id="coreRequired" checked> Core units required</label>
                <label>Total units: <input type="number" id="totalUnits" value="16"></label>
            </div>
        </div>
        
        <div id="export" class="tab-content">
            <h2>Generate Planner</h2>
            <button onclick="generatePlanner()">Generate</button>
            <textarea id="generatedCode" readonly></textarea>
            <button onclick="downloadPlanner()">Download</button>
            <button onclick="testPlanner()">Test</button>
        </div>
    </div>

    <script>
        // Data storage
        const appData = {
            groups: [
                {id: "core", name: "Core Units", min: 1, max: 1}
            ],
            units: [
                {code: "SAMPLE001", name: "Sample Unit", groups: ["core"], duration: 6}
            ]
        };

        // Tab navigation
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabId).classList.add('active');
            event.currentTarget.classList.add('active');
            
            if (tabId === 'groups') renderGroups();
            if (tabId === 'units') renderUnits();
        }

        // Group management
        function renderGroups() {
            const tbody = document.querySelector('#groupsTable tbody');
            tbody.innerHTML = '';
            
            appData.groups.forEach((group, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input value="${group.id}" onchange="appData.groups[${index}].id = this.value"></td>
                    <td><input value="${group.name}" onchange="appData.groups[${index}].name = this.value"></td>
                    <td><input type="number" value="${group.min}" onchange="appData.groups[${index}].min = this.value"></td>
                    <td><input type="number" value="${group.max}" onchange="appData.groups[${index}].max = this.value"></td>
                    <td><button onclick="deleteGroup(${index})">Delete</button></td>
                `;
                tbody.appendChild(row);
            });
        }

        function addGroup() {
            const id = prompt("Enter group ID:");
            if (!id) return;
            
            const name = prompt("Enter group name:", id);
            appData.groups.push({
                id: id,
                name: name,
                min: 1,
                max: 1
            });
            renderGroups();
        }

        function deleteGroup(index) {
            if (confirm("Delete this group?")) {
                appData.groups.splice(index, 1);
                renderGroups();
            }
        }

        // Unit management
        function renderUnits() {
            const tbody = document.querySelector('#unitsTable tbody');
            tbody.innerHTML = '';
            
            appData.units.forEach((unit, index) => {
                const row = document.createElement('tr');
                
                // Create group options
                let options = '';
                appData.groups.forEach(group => {
                    const selected = unit.groups.includes(group.id) ? 'selected' : '';
                    options += `<option value="${group.id}" ${selected}>${group.name}</option>`;
                });
                
                row.innerHTML = `
                    <td><input value="${unit.code}" onchange="appData.units[${index}].code = this.value"></td>
                    <td><input value="${unit.name}" onchange="appData.units[${index}].name = this.value"></td>
                    <td>
                        <select multiple onchange="updateUnitGroups(${index}, this)">
                            ${options}
                        </select>
                    </td>
                    <td><input type="number" value="${unit.duration}" onchange="appData.units[${index}].duration = this.value"></td>
                    <td><button onclick="deleteUnit(${index})">Delete</button></td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateUnitGroups(index, select) {
            const selected = Array.from(select.selectedOptions).map(opt => opt.value);
            appData.units[index].groups = selected;
        }

        function addUnit() {
            const code = prompt("Enter unit code:");
            if (!code) return;
            
            const name = prompt("Enter unit name:");
            appData.units.push({
                code: code,
                name: name,
                groups: ["core"],
                duration: parseInt(document.getElementById('defaultDuration').value) || 6
            });
            renderUnits();
        }

        function deleteUnit(index) {
            if (confirm("Delete this unit?")) {
                appData.units.splice(index, 1);
                renderUnits();
            }
        }

        // Generation functions
        function generatePlanner() {
            const config = {
                title: document.getElementById('qualTitle').value || "Qualification",
                code: document.getElementById('qualCode').value || "",
                groups: appData.groups,
                units: appData.units,
                rules: {
                    coreRequired: document.getElementById('coreRequired').checked,
                    totalUnits: parseInt(document.getElementById('totalUnits').value) || 16
                }
            };
            
            const html = `<!DOCTYPE html>
<html>
<head>
    <title>${config.title}</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        h1 { color: #2c3e50; }
    </style>
</head>
<body>
    <h1>${config.title}${config.code ? ` (${config.code})` : ''}</h1>
    <p>Generated qualification planner would appear here</p>
</body>
</html>`;
            
            document.getElementById('generatedCode').value = html;
        }

        function downloadPlanner() {
            const code = document.getElementById('generatedCode').value;
            if (!code) return alert('Generate the planner first');
            
            const blob = new Blob([code], {type: 'text/html'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'planner.html';
            a.click();
        }

        function testPlanner() {
            const code = document.getElementById('generatedCode').value;
            if (!code) return alert('Generate the planner first');
            
            const win = window.open('', '_blank');
            win.document.write(code);
            win.document.close();
        }
    </script>
</body>
</html>
