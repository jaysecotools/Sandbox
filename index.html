<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Web-based tool for assessing biosecurity risks in projects">
    <title>Biosecurity Risk Assessment Tool</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        /* General Reset */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f9fa;
            color: #333;
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }

        body.dark-mode {
            background-color: #1a1a1a;
            color: #e0e0e0;
        }

        /* Typography */
        h1, h2, h3, h4 {
            color: #007a6c;
            margin-bottom: 15px;
            transition: color 0.3s;
        }

        .dark-mode h1, 
        .dark-mode h2, 
        .dark-mode h3, 
        .dark-mode h4 {
            color: #4db8a7;
        }

        h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }

        h2 {
            font-size: 22px;
            border-bottom: 2px solid #e0f0ee;
            padding-bottom: 10px;
            margin-bottom: 20px;
            transition: border-color 0.3s;
        }

        .dark-mode h2 {
            border-bottom-color: #2a4a45;
        }

        h3 {
            font-size: 18px;
            color: #4a4a4a;
            transition: color 0.3s;
        }

        .dark-mode h3 {
            color: #c0c0c0;
        }

        .subtitle {
            color: #e5e5e5;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .dark-mode .subtitle {
            color: #a0a0a0;
        }

        /* Layout */
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            text-align: center;
            padding: 25px 10px;
            background-color: #007a6c;
            color: white;
            border-radius: 5px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s;
        }

        .dark-mode header {
            background-color: #005a50;
        }

        header h1 {
            color: white;
            margin-bottom: 0;
        }

        /* Theme Toggle */
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            transition: all 0.3s;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .dark-mode .theme-toggle {
            background: rgba(0, 0, 0, 0.2);
            color: #e0e0e0;
        }

        .dark-mode .theme-toggle:hover {
            background: rgba(0, 0, 0, 0.3);
        }

        /* Progress Indicator */
        .progress-container {
            margin-bottom: 30px;
        }

        .progress-bar {
            height: 6px;
            background-color: #007a6c;
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 3px;
            margin-bottom: 10px;
        }

        .dark-mode .progress-bar {
            background-color: #4db8a7;
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            position: relative;
        }

        .progress-step {
            flex: 1;
            text-align: center;
            color: #999;
            font-size: 14px;
            position: relative;
            padding-top: 25px;
            transition: color 0.3s;
        }

        .dark-mode .progress-step {
            color: #666;
        }

        .progress-step:before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 20px;
            background-color: #ddd;
            border-radius: 50%;
            z-index: 1;
            transition: background-color 0.3s;
        }

        .dark-mode .progress-step:before {
            background-color: #444;
        }

        .progress-step.active:before, 
        .progress-step.completed:before {
            background-color: #007a6c;
        }

        .dark-mode .progress-step.active:before,
        .dark-mode .progress-step.completed:before {
            background-color: #4db8a7;
        }

        .progress-step.completed:after {
            content: '\f00c';
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            color: white;
            position: absolute;
            top: 2px;
            right: 50%;
            transform: translateX(50%);
            font-size: 12px;
            z-index: 2;
        }

        .progress-step.current {
            color: #007a6c;
            font-weight: bold;
        }

        .dark-mode .progress-step.current {
            color: #4db8a7;
        }

        /* Card Sections */
        .card {
            background: white;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #007a6c;
            display: none;
            transition: all 0.3s;
        }

        .dark-mode .card {
            background: #2a2a2a;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            border-left-color: #4db8a7;
        }

        .card.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Form Styling */
        .form-group {
            margin-bottom: 20px;
            position: relative;
            flex: 1 1 100%;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-row .form-group {
            flex: 1;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a4a4a;
            transition: color 0.3s;
        }

        .dark-mode label {
            color: #c0c0c0;
        }

        .input-icon {
            position: absolute;
            right: 10px;
            top: 35px;
            color: #007a6c;
            font-size: 16px;
            transition: color 0.3s;
        }

        .dark-mode .input-icon {
            color: #4db8a7;
        }

        input[type="text"],
        input[type="date"],
        input[type="number"],
        textarea,
        select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 15px;
            transition: all 0.3s;
            background-color: #f9fbfa;
        }

        .dark-mode input[type="text"],
        .dark-mode input[type="date"],
        .dark-mode input[type="number"],
        .dark-mode textarea,
        .dark-mode select {
            background-color: #333;
            border-color: #444;
            color: #e0e0e0;
        }

        input[type="text"]:focus,
        input[type="date"]:focus,
        input[type="number"]:focus,
        textarea:focus,
        select:focus {
            border-color: #007a6c;
            outline: none;
            box-shadow: 0 0 0 2px rgba(0, 122, 108, 0.2);
        }

        .dark-mode input[type="text"]:focus,
        .dark-mode input[type="date"]:focus,
        .dark-mode input[type="number"]:focus,
        .dark-mode textarea:focus,
        .dark-mode select:focus {
            border-color: #4db8a7;
            box-shadow: 0 0 0 2px rgba(77, 184, 167, 0.3);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .select-container {
            position: relative;
        }

        .select-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            color: #007a6c;
            transition: color 0.3s;
        }

        .dark-mode .select-icon {
            color: #4db8a7;
        }

        select {
            appearance: none;
            padding-right: 40px;
        }

        select[multiple] {
            height: auto;
            min-height: 100px;
            padding: 10px;
        }

        select[multiple] option {
            padding: 8px 10px;
            margin: 2px 0;
            background-color: #f0f7f6;
            border-radius: 3px;
            transition: all 0.3s;
        }

        .dark-mode select[multiple] option {
            background-color: #3a3a3a;
            color: #e0e0e0;
        }

        .hint {
            display: block;
            margin-top: 5px;
            font-size: 13px;
            color: #777;
            font-style: italic;
            transition: color 0.3s;
        }

        .dark-mode .hint {
            color: #888;
        }

        /* Tooltip Styling */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
            margin-left: 5px;
            color: #007a6c;
            transition: color 0.3s;
        }

        .dark-mode .tooltip {
            color: #4db8a7;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 14px;
            font-weight: normal;
            line-height: 1.4;
        }

        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* Error Styling */
        .error {
            border-color: #e74c3c !important;
        }

        .error-message {
            color: #e74c3c;
            font-size: 13px;
            margin-top: 5px;
            display: block;
        }

        /* Risk Sliders */
        .risk-sliders {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .slider-container {
            margin-bottom: 15px;
        }

        .slider-wrapper {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 5px;
        }

        .risk-icon {
            color: #007a6c;
            font-size: 18px;
            width: 24px;
            text-align: center;
            transition: color 0.3s;
        }

        .dark-mode .risk-icon {
            color: #4db8a7;
        }

        input[type="range"] {
            flex: 1;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(to right, #4CAF50 0%, #FFC107 50%, #F44336 100%);
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #007a6c;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
        }

        .dark-mode input[type="range"]::-webkit-slider-thumb {
            background: #4db8a7;
            border-color: #333;
        }

        input[type="range"].low-risk::-webkit-slider-thumb {
            background: #4CAF50;
        }

        input[type="range"].medium-risk::-webkit-slider-thumb {
            background: #FFC107;
        }

        input[type="range"].high-risk::-webkit-slider-thumb {
            background: #F44336;
        }

        output {
            min-width: 40px;
            text-align: center;
            font-weight: bold;
            color: #007a6c;
            background: #e0f0ee;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .dark-mode output {
            color: #4db8a7;
            background: #2a4a45;
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 12px;
            color: #777;
            transition: color 0.3s;
        }

        .dark-mode .slider-labels {
            color: #888;
        }

        /* Risk Assessment Results */
        .risk-summary {
            display: flex;
            gap: 30px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .risk-score-container {
            flex: 1;
            min-width: 250px;
            background: #f0f7f6;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            transition: background-color 0.3s;
        }

        .dark-mode .risk-score-container {
            background: #2a3a38;
        }

        .risk-meter {
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            margin: 15px 0;
            overflow: hidden;
            transition: background-color 0.3s;
        }

        .dark-mode .risk-meter {
            background: #444;
        }

        .risk-meter-fill {
            height: 100%;
            width: 0%;
            transition: width 0.5s ease, background-color 0.5s ease;
        }

        .risk-meter-fill.low {
            background: #4CAF50;
        }

        .risk-meter-fill.medium {
            background: #FFC107;
        }

        .risk-meter-fill.high {
            background: #F44336;
        }

        .risk-score-display {
            font-size: 24px;
            font-weight: bold;
            margin-top: 10px;
        }

        .risk-score-display #risk-score {
            color: #007a6c;
            font-size: 36px;
            transition: color 0.3s;
        }

        .dark-mode .risk-score-display #risk-score {
            color: #4db8a7;
        }

        .risk-level {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 16px;
            margin-left: 10px;
        }

        .risk-level.low {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .dark-mode .risk-level.low {
            background: #1e3e20;
            color: #a5d6a7;
        }

        .risk-level.medium {
            background: #fff8e1;
            color: #ff8f00;
        }

        .dark-mode .risk-level.medium {
            background: #3e2e00;
            color: #ffd54f;
        }

        .risk-level.high {
            background: #ffebee;
            color: #c62828;
        }

        .dark-mode .risk-level.high {
            background: #4a1a1a;
            color: #ff8a80;
        }

        .risk-breakdown {
            flex: 2;
            min-width: 300px;
        }

        #impact-chart {
            width: 100% !important;
            height: 300px !important;
        }

        /* Heat Map Styling */
        .heat-map-container {
            margin-top: 20px;
            width: 100%;
            height: 300px;
            position: relative;
            border-radius: 8px;
            overflow: hidden;
        }

        .heat-map {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .heat-map-row {
            display: flex;
            flex: 1;
        }

        .heat-map-cell {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
        }

        .heat-map-cell:hover {
            transform: scale(1.05);
            z-index: 1;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }

        .heat-map-cell .cell-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 10;
        }

        .heat-map-cell:hover .cell-tooltip {
            visibility: visible;
            opacity: 1;
        }

        /* Scenario Modeling */
        .scenario-container {
            margin-top: 30px;
            background: #f0f7f6;
            padding: 20px;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .dark-mode .scenario-container {
            background: #2a3a38;
        }

        .scenario-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .scenario-select {
            flex: 1;
            min-width: 200px;
        }

        .scenario-result {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            display: none;
            transition: all 0.3s;
        }

        .dark-mode .scenario-result {
            background: #333;
        }

        .scenario-result.active {
            display: block;
        }

        .scenario-comparison {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }

        .scenario-comparison-item {
            flex: 1;
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            background: #e0f0ee;
            transition: all 0.3s;
        }

        .dark-mode .scenario-comparison-item {
            background: #2a4a45;
        }

        .scenario-comparison-value {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }

        /* Recommendations */
        .recommendations-container {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #e57200;
            transition: all 0.3s;
        }

        .dark-mode .recommendations-container {
            background: #333;
            border-left-color: #ff9800;
        }

        .recommendations-list ul {
            list-style-type: none;
        }

        .recommendations-list li {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            position: relative;
            padding-left: 25px;
            transition: border-color 0.3s;
        }

        .dark-mode .recommendations-list li {
            border-bottom-color: #444;
        }

        .recommendations-list li:before {
            content: '\f058';
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            color: #e57200;
            position: absolute;
            left: 0;
            top: 10px;
            transition: color 0.3s;
        }

        .dark-mode .recommendations-list li:before {
            color: #ff9800;
        }

        .recommendations-list li:last-child {
            border-bottom: none;
        }

        .risk-factors {
            margin-bottom: 15px;
            padding: 10px;
            background: #e0f0ee;
            border-radius: 5px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .dark-mode .risk-factors {
            background: #2a4a45;
        }

        .no-risks {
            text-align: center;
            padding: 20px;
            color: #4CAF50;
            transition: color 0.3s;
        }

        .dark-mode .no-risks {
            color: #81c784;
        }

        .no-risks i {
            font-size: 40px;
            margin-bottom: 15px;
        }

        /* Notes Section */
        .notes-section {
            margin-top: 30px;
        }

        .notes-section textarea {
            min-height: 150px;
        }

        /* Buttons */
        .button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            gap: 8px;
        }

        .button i {
            font-size: 14px;
        }

        .primary-button {
            background-color: #007a6c;
            color: white;
        }

        .primary-button:hover {
            background-color: #00665a;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 122, 108, 0.3);
        }

        .dark-mode .primary-button {
            background-color: #4db8a7;
        }

        .dark-mode .primary-button:hover {
            background-color: #3da897;
        }

        .secondary-button {
            background-color: #4a4a4a;
            color: white;
        }

        .secondary-button:hover {
            background-color: #333;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(74, 74, 74, 0.3);
        }

        .dark-mode .secondary-button {
            background-color: #666;
        }

        .dark-mode .secondary-button:hover {
            background-color: #555;
        }

        .danger-button {
            background-color: #e74c3c;
            color: white;
        }

        .danger-button:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(231, 76, 60, 0.3);
        }

        .prev-button {
            background-color: #f5f5f5;
            color: #4a4a4a;
        }

        .prev-button:hover {
            background-color: #e0e0e0;
        }

        .dark-mode .prev-button {
            background-color: #444;
            color: #e0e0e0;
        }

        .dark-mode .prev-button:hover {
            background-color: #555;
        }

        .next-button {
            background-color: #e57200;
            color: white;
        }

        .next-button:hover {
            background-color: #d16600;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(229, 114, 0, 0.3);
        }

        .dark-mode .next-button {
            background-color: #ff9800;
        }

        .dark-mode .next-button:hover {
            background-color: #e68a00;
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 30px;
        }

        /* Save Progress Button */
        .save-progress-button {
            background-color: #3498db;
            color: white;
        }

        .save-progress-button:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
        }

        .dark-mode .save-progress-button {
            background-color: #5dade2;
        }

        .dark-mode .save-progress-button:hover {
            background-color: #3498db;
        }

        /* Disclaimer */
        .disclaimer {
            background: #fff8e1;
            border-left-color: #ffc107;
            transition: all 0.3s;
        }

        .dark-mode .disclaimer {
            background: #3a3a00;
            border-left-color: #ffd54f;
        }

        .disclaimer h3 {
            color: #e57200;
            transition: color 0.3s;
        }

        .dark-mode .disclaimer h3 {
            color: #ff9800;
        }

        /* Footer */
        footer {
            margin-top: 40px;
            padding: 20px 0;
            border-top: 1px solid #e0e0e0;
            text-align: center;
            color: #666;
            font-size: 14px;
            transition: all 0.3s;
        }

        .dark-mode footer {
            border-top-color: #444;
            color: #888;
        }

        .footer-content {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .footer-links a {
            color: #007a6c;
            text-decoration: none;
            transition: color 0.3s;
        }

        .dark-mode .footer-links a {
            color: #4db8a7;
        }

        .footer-links a:hover {
            color: #e57200;
            text-decoration: underline;
        }

        .dark-mode .footer-links a:hover {
            color: #ff9800;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 25px;
            border-radius: 8px;
            width: 80%;
            max-width: 600px;
            position: relative;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
        }

        .dark-mode .modal-content {
            background-color: #2a2a2a;
        }

        .close-modal {
            position: absolute;
            right: 20px;
            top: 15px;
            font-size: 24px;
            font-weight: bold;
            color: #777;
            cursor: pointer;
            transition: color 0.3s;
        }

        .dark-mode .close-modal {
            color: #888;
        }

        .close-modal:hover {
            color: #333;
        }

        .dark-mode .close-modal:hover {
            color: #e0e0e0;
        }

        /* Confirmation Dialog */
        .confirmation-dialog {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .confirmation-content {
            background-color: white;
            margin: 20% auto;
            padding: 25px;
            border-radius: 8px;
            width: 80%;
            max-width: 500px;
            position: relative;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
        }

        .dark-mode .confirmation-content {
            background-color: #2a2a2a;
        }

        .confirmation-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        /* Map Styling */
        .map-container {
            margin-bottom: 20px;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #ddd;
            height: 300px;
            position: relative;
            transition: border-color 0.3s;
        }

        .dark-mode .map-container {
            border-color: #444;
        }

        #map {
            height: 100%;
            width: 100%;
            background-color: #f5f5f5;
            transition: background-color 0.3s;
        }

        .dark-mode #map {
            background-color: #333;
        }

        .map-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .map-coordinates {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
            font-family: monospace;
            transition: color 0.3s;
        }

        .dark-mode .map-coordinates {
            color: #888;
        }

        .location-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .location-button {
            padding: 8px 15px;
            font-size: 14px;
            background-color: #007a6c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: background-color 0.3s;
        }

        .dark-mode .location-button {
            background-color: #4db8a7;
        }

        .location-button:hover {
            background-color: #00665a;
        }

        .dark-mode .location-button:hover {
            background-color: #3da897;
        }

        .location-button i {
            font-size: 12px;
        }

        /* Photo Upload Styles */
        .photo-upload {
            margin-bottom: 20px;
        }

        .photo-options {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .photo-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .photo-preview {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: 4px;
            overflow: hidden;
            border: 1px solid #ddd;
            transition: border-color 0.3s;
        }

        .dark-mode .photo-preview {
            border-color: #444;
        }

        .photo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-preview .delete-photo {
            position: absolute;
            top: 2px;
            right: 2px;
            background: rgba(0,0,0,0.5);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 10px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .photo-preview .delete-photo:hover {
            background: rgba(0,0,0,0.7);
        }

        /* Welcome Modal */
        .welcome-modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
        }

        .welcome-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 8px;
            width: 80%;
            max-width: 800px;
            position: relative;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
        }

        .dark-mode .welcome-content {
            background-color: #2a2a2a;
        }

        .welcome-steps {
            margin-top: 20px;
        }

        .welcome-step {
            display: flex;
            margin-bottom: 15px;
            align-items: flex-start;
        }

        .welcome-step-number {
            background-color: #007a6c;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            flex-shrink: 0;
            transition: background-color 0.3s;
        }

        .dark-mode .welcome-step-number {
            background-color: #4db8a7;
        }

        .welcome-step-content {
            flex: 1;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .form-row {
                flex-direction: column;
                gap: 0;
            }

            .risk-summary {
                flex-direction: column;
            }

            .risk-score-container {
                margin-bottom: 20px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .button {
                width: 100%;
                margin-bottom: 10px;
            }

            .navigation-buttons {
                flex-direction: column-reverse;
                gap: 10px;
            }

            .prev-button, .next-button {
                width: 100%;
            }

            .modal-content, .confirmation-content, .welcome-content {
                width: 90%;
                margin: 20% auto;
            }

            .photo-options {
                flex-direction: column;
            }

            .theme-toggle {
                position: relative;
                top: auto;
                right: auto;
                margin-bottom: 15px;
            }

            .scenario-controls {
                flex-direction: column;
            }
        }

        @media (max-width: 480px) {
            header h1 {
                font-size: 22px;
            }

            .card {
                padding: 15px;
            }

            .progress-step {
                font-size: 12px;
            }

            .welcome-content {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-shield-virus"></i> Biosecurity Risk Assessment Tool</h1>
            <p class="subtitle">Comprehensive risk evaluation for biological safety</p>
            <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode">
                <i class="fas fa-moon"></i>
            </button>
        </header>

        <!-- Progress Indicator -->
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
            <div class="progress-steps">
                <span class="progress-step active">1. Project</span>
                <span class="progress-step">2. Site</span>
                <span class="progress-step">3. Risks</span>
                <span class="progress-step">4. Results</span>
            </div>
        </div>

        <!-- Project Details Section -->
        <section class="card active" id="project-section">
            <h2><i class="fas fa-project-diagram"></i> Project Details</h2>
            <form id="project-details-form">
                <div class="form-group">
                    <label for="project-name">Project Name: <span class="tooltip"><i class="fas fa-info-circle"></i>
                        <span class="tooltiptext">Enter the name of your project for identification purposes</span>
                    </span></label>
                    <input type="text" id="project-name" placeholder="Enter the project name" required aria-required="true">
                    <span class="input-icon"><i class="fas fa-tasks"></i></span>
                </div>

                <div class="form-group">
                    <label for="location">Location: <span class="tooltip"><i class="fas fa-info-circle"></i>
                        <span class="tooltiptext">Enter the project location (address or coordinates)</span>
                    </span></label>
                    <input type="text" id="location" placeholder="e.g., GPS coordinates or address" required aria-required="true">
                    <span class="input-icon"><i class="fas fa-map-marker-alt"></i></span>
                </div>

                <!-- Map Container -->
                <div class="map-container">
                    <div id="map" aria-label="Project location map"></div>
                    <div class="map-coordinates" id="coordinates-display">Lat: 0, Lng: 0</div>
                </div>
                
                <div class="location-buttons">
                    <button type="button" class="location-button" id="get-location-btn">
                        <i class="fas fa-location-arrow"></i> Use My Location
                    </button>
                    <button type="button" class="location-button" id="search-location-btn">
                        <i class="fas fa-search"></i> Search Location
                    </button>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="assessor-name">Assessor Name: <span class="tooltip"><i class="fas fa-info-circle"></i>
                            <span class="tooltiptext">Name of the person conducting this assessment</span>
                        </span></label>
                        <input type="text" id="assessor-name" placeholder="Enter the assessor's name" required aria-required="true">
                        <span class="input-icon"><i class="fas fa-user"></i></span>
                    </div>

                    <div class="form-group">
                        <label for="date">Date of Assessment: <span class="tooltip"><i class="fas fa-info-circle"></i>
                            <span class="tooltiptext">When this assessment is being conducted</span>
                        </span></label>
                        <input type="date" id="date" required aria-required="true">
                        <span class="input-icon"><i class="fas fa-calendar-alt"></i></span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="project-description">Project Description: <span class="tooltip"><i class="fas fa-info-circle"></i>
                        <span class="tooltiptext">Brief description of the project activities</span>
                    </span></label>
                    <textarea id="project-description" rows="3" placeholder="Provide a detailed description..." aria-label="Project description"></textarea>
                </div>

                <div class="form-group">
                    <label for="project-purpose">Purpose of the Project: <span class="tooltip"><i class="fas fa-info-circle"></i>
                        <span class="tooltiptext">Objectives and goals of this project</span>
                    </span></label>
                    <textarea id="project-purpose" rows="3" placeholder="State the project's goals and objectives..." aria-label="Project purpose"></textarea>
                </div>

                <!-- Photo Upload Section -->
                <div class="form-group photo-upload">
                    <label>Add Project Photos: <span class="tooltip"><i class="fas fa-info-circle"></i>
                        <span class="tooltiptext">Upload or take photos of the project site</span>
                    </span></label>
                    <div class="photo-options">
                        <button type="button" class="button secondary-button" id="take-photo-btn" aria-label="Take photo">
                            <i class="fas fa-camera"></i> Take Photo
                        </button>
                        <button type="button" class="button secondary-button" id="upload-photo-btn" aria-label="Upload photo">
                            <i class="fas fa-upload"></i> Upload Photo
                        </button>
                    </div>
                    <div class="photo-preview-container" id="photo-preview" aria-label="Project photos"></div>
                    <input type="file" id="photo-input" accept="image/*" capture="environment" style="display:none;" aria-hidden="true">
                </div>

                <div class="navigation-buttons">
                    <button type="button" class="button save-progress-button" id="save-progress-btn">
                        <i class="fas fa-save"></i> Save Progress
                    </button>
                    <button type="button" class="button next-button" onclick="nextSection('project-section', 'site-section')">
                        Next: Site Information <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </form>
        </section>

        <!-- Site Information Section -->
        <section class="card" id="site-section">
            <h2><i class="fas fa-map-marked-alt"></i> Site Information</h2>
            <form>
                <div class="form-group">
                    <label for="flora-fauna">Flora & Fauna Observed: <span class="tooltip"><i class="fas fa-info-circle"></i>
                        <span class="tooltiptext">List all observed plant and animal species at the site</span>
                    </span></label>
                    <textarea id="flora-fauna" rows="3" placeholder="List observed species here..." aria-label="Flora and fauna observed"></textarea>
                </div>

                <div class="form-group">
                    <label for="environmental-features">Environmental Features: <span class="tooltip"><i class="fas fa-info-circle"></i>
                        <span class="tooltiptext">Select all environmental features present at the site</span>
                    </span></label>
                    <div class="select-container">
                        <select id="environmental-features" multiple aria-label="Select environmental features">
                            <option value="wetlands">Wetlands</option>
                            <option value="forest">Forest</option>
                            <option value="urban-area">Urban Area</option>
                            <option value="agricultural-land">Agricultural Land</option>
                            <option value="coastal-zone">Coastal Zone</option>
                        </select>
                        <span class="select-icon"><i class="fas fa-chevron-down"></i></span>
                    </div>
                    <small class="hint">Hold Ctrl/Cmd to select multiple options</small>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="distance-ecosystem">Distance to Sensitive Ecosystems (km): <span class="tooltip"><i class="fas fa-info-circle"></i>
                            <span class="tooltiptext">Distance to protected or sensitive ecological areas</span>
                        </span></label>
                        <input type="number" id="distance-ecosystem" placeholder="Enter distance..." min="0" step="0.1" aria-label="Distance to sensitive ecosystems in kilometers">
                        <span class="input-icon"><i class="fas fa-tree"></i></span>
                    </div>

                    <div class="form-group">
                        <label for="distance-infrastructure">Distance to Critical Infrastructure (km): <span class="tooltip"><i class="fas fa-info-circle"></i>
                            <span class="tooltiptext">Distance to important infrastructure like water treatment plants</span>
                        </span></label>
                        <input type="number" id="distance-infrastructure" placeholder="Enter distance..." min="0" step="0.1" aria-label="Distance to critical infrastructure in kilometers">
                        <span class="input-icon"><i class="fas fa-building"></i></span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="land-use-history">Land Use History: <span class="tooltip"><i class="fas fa-info-circle"></i>
                        <span class="tooltiptext">Previous uses of this land (e.g., farming, industrial)</span>
                    </span></label>
                    <textarea id="land-use-history" rows="4" placeholder="E.g., farming, industrial activity..." aria-label="Land use history"></textarea>
                </div>

                <div class="form-group">
                    <label for="current-activities">Current Site Activities: <span class="tooltip"><i class="fas fa-info-circle"></i>
                        <span class="tooltiptext">Current activities happening at the site</span>
                    </span></label>
                    <textarea id="current-activities" rows="4" placeholder="E.g., construction, transportation..." aria-label="Current site activities"></textarea>
                </div>

                <div class="form-group">
                    <label for="accessibility">Site Accessibility: <span class="tooltip"><i class="fas fa-info-circle"></i>
                        <span class="tooltiptext">How the site is accessed (roads, ports, etc.)</span>
                    </span></label>
                    <div class="select-container">
                        <select id="accessibility" aria-label="Select site accessibility type">
                            <option value="" disabled selected>Select accessibility type</option>
                            <option value="road">Road Access</option>
                            <option value="port">Port</option>
                            <option value="rail">Rail Connections</option>
                            <option value="air">Air Transport</option>
                        </select>
                        <span class="select-icon"><i class="fas fa-chevron-down"></i></span>
                    </div>
                </div>

                <!-- Photo Upload Section -->
                <div class="form-group photo-upload">
                    <label>Add Site Photos: <span class="tooltip"><i class="fas fa-info-circle"></i>
                        <span class="tooltiptext">Upload or take photos of the site features</span>
                    </span></label>
                    <div class="photo-options">
                        <button type="button" class="button secondary-button" id="take-photo-btn-site" aria-label="Take site photo">
                            <i class="fas fa-camera"></i> Take Photo
                        </button>
                        <button type="button" class="button secondary-button" id="upload-photo-btn-site" aria-label="Upload site photo">
                            <i class="fas fa-upload"></i> Upload Photo
                        </button>
                    </div>
                    <div class="photo-preview-container" id="photo-preview-site" aria-label="Site photos"></div>
                    <input type="file" id="photo-input-site" accept="image/*" capture="environment" style="display:none;" aria-hidden="true">
                </div>

                <!-- Notes Section -->
                <div class="form-group notes-section">
                    <label for="site-notes">Additional Site Notes: <span class="tooltip"><i class="fas fa-info-circle"></i>
                        <span class="tooltiptext">Any additional observations about the site</span>
                    </span></label>
                    <textarea id="site-notes" rows="4" placeholder="Add any additional notes about the site..." aria-label="Additional site notes"></textarea>
                </div>

                <div class="navigation-buttons">
                    <button type="button" class="button prev-button" onclick="prevSection('site-section', 'project-section')">
                        <i class="fas fa-arrow-left"></i> Previous
                    </button>
                    <button type="button" class="button save-progress-button" id="save-progress-btn-site">
                        <i class="fas fa-save"></i> Save Progress
                    </button>
                    <button type="button" class="button next-button" onclick="nextSection('site-section', 'risk-section')">
                        Next: Risk Metrics <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </form>
        </section>

        <!-- Biosecurity Risk Metrics Section -->
        <section class="card" id="risk-section">
            <h2><i class="fas fa-exclamation-triangle"></i> Biosecurity Risk Metrics</h2>
            <div class="risk-sliders">
                <div class="slider-container">
                    <label for="invasive-species">Invasive Species Risk: <span class="tooltip"><i class="fas fa-info-circle"></i>
                        <span class="tooltiptext">Risk of introducing or spreading invasive species</span>
                    </span></label>
                    <div class="slider-wrapper">
                        <input type="range" id="invasive-species" min="0" max="100" value="0" data-weight="0.28" aria-label="Invasive species risk level">
                        <output id="invasive-species-value" aria-live="polite">0</output>
                        <span class="risk-icon"><i class="fas fa-bug"></i></span>
                    </div>
                    <div class="slider-labels">
                        <span>Low</span>
                        <span>Medium</span>
                        <span>High</span>
                    </div>
                </div>

                <div class="slider-container">
                    <label for="pathogen-spread">Pathogen Spread Risk: <span class="tooltip"><i class="fas fa-info-circle"></i>
                        <span class="tooltiptext">Risk of spreading diseases or pathogens</span>
                    </span></label>
                    <div class="slider-wrapper">
                        <input type="range" id="pathogen-spread" min="0" max="100" value="0" data-weight="0.22" aria-label="Pathogen spread risk level">
                        <output id="pathogen-spread-value" aria-live="polite">0</output>
                        <span class="risk-icon"><i class="fas fa-virus"></i></span>
                    </div>
                    <div class="slider-labels">
                        <span>Low</span>
                        <span>Medium</span>
                        <span>High</span>
                    </div>
                </div>

                <div class="slider-container">
                    <label for="contamination">Contamination Risk: <span class="tooltip"><i class="fas fa-info-circle"></i>
                        <span class="tooltiptext">Risk of environmental contamination</span>
                    </span></label>
                    <div class="slider-wrapper">
                        <input type="range" id="contamination" min="0" max="100" value="0" data-weight="0.18" aria-label="Contamination risk level">
                        <output id="contamination-value" aria-live="polite">0</output>
                        <span class="risk-icon"><i class="fas fa-biohazard"></i></span>
                    </div>
                    <div class="slider-labels">
                        <span>Low</span>
                        <span>Medium</span>
                        <span>High</span>
                    </div>
                </div>

                <div class="slider-container">
                    <label for="transportation">Transportation Risk: <span class="tooltip"><i class="fas fa-info-circle"></i>
                        <span class="tooltiptext">Risk from transportation of materials/equipment</span>
                    </span></label>
                    <div class="slider-wrapper">
                        <input type="range" id="transportation" min="0" max="100" value="0" data-weight="0.12" aria-label="Transportation risk level">
                        <output id="transportation-value" aria-live="polite">0</output>
                        <span class="risk-icon"><i class="fas fa-truck"></i></span>
                    </div>
                    <div class="slider-labels">
                        <span>Low</span>
                        <span>Medium</span>
                        <span>High</span>
                    </div>
                </div>

                <div class="slider-container">
                    <label for="quarantine-breach">Quarantine Breach Risk: <span class="tooltip"><i class="fas fa-info-circle"></i>
                        <span class="tooltiptext">Risk of quarantine protocols being breached</span>
                    </span></label>
                    <div class="slider-wrapper">
                        <input type="range" id="quarantine-breach" min="0" max="100" value="0" data-weight="0.10" aria-label="Quarantine breach risk level">
                        <output id="quarantine-breach-value" aria-live="polite">0</output>
                        <span class="risk-icon"><i class="fas fa-shield-alt"></i></span>
                    </div>
                    <div class="slider-labels">
                        <span>Low</span>
                        <span>Medium</span>
                        <span>High</span>
                    </div>
                </div>

                <div class="slider-container">
                    <label for="training-compliance">Biosecurity Training Compliance: <span class="tooltip"><i class="fas fa-info-circle"></i>
                        <span class="tooltiptext">Level of compliance with biosecurity training</span>
                    </span></label>
                    <div class="slider-wrapper">
                        <input type="range" id="training-compliance" min="0" max="100" value="0" data-weight="0.10" aria-label="Biosecurity training compliance level">
                        <output id="training-compliance-value" aria-live="polite">0</output>
                        <span class="risk-icon"><i class="fas fa-graduation-cap"></i></span>
                    </div>
                    <div class="slider-labels">
                        <span>Low</span>
                        <span>Medium</span>
                        <span>High</span>
                    </div>
                </div>

                <div class="slider-container">
                    <label for="supply-chain">Supply Chain Risk: <span class="tooltip"><i class="fas fa-info-circle"></i>
                        <span class="tooltiptext">Risk from supply chain vulnerabilities</span>
                    </span></label>
                    <div class="slider-wrapper">
                        <input type="range" id="supply-chain" min="0" max="100" value="0" data-weight="0.10" aria-label="Supply chain risk level">
                        <output id="supply-chain-value" aria-live="polite">0</output>
                        <span class="risk-icon"><i class="fas fa-boxes"></i></span>
                    </div>
                    <div class="slider-labels">
                        <span>Low</span>
                        <span>Medium</span>
                        <span>High</span>
                    </div>
                </div>
            </div>

            <!-- Scenario Modeling Section -->
            <div class="scenario-container">
                <h3><i class="fas fa-random"></i> Scenario Modeling</h3>
                <p>Explore "what-if" scenarios to understand how different factors affect your risk profile.</p>
                
                <div class="scenario-controls">
                    <div class="form-group scenario-select">
                        <label for="scenario-factor">Select Factor:</label>
                        <select id="scenario-factor" class="form-control">
                            <option value="invasive-species">Invasive Species Risk</option>
                            <option value="pathogen-spread">Pathogen Spread Risk</option>
                            <option value="contamination">Contamination Risk</option>
                            <option value="transportation">Transportation Risk</option>
                            <option value="quarantine-breach">Quarantine Breach Risk</option>
                            <option value="training-compliance">Training Compliance</option>
                            <option value="supply-chain">Supply Chain Risk</option>
                        </select>
                    </div>
                    
                    <div class="form-group scenario-select">
                        <label for="scenario-value">Set Value:</label>
                        <input type="range" id="scenario-value" min="0" max="100" value="50" class="form-control">
                        <output id="scenario-value-display">50</output>
                    </div>
                    
                    <button type="button" class="button primary-button" id="run-scenario">
                        <i class="fas fa-play"></i> Run Scenario
                    </button>
                </div>
                
                <div class="scenario-result" id="scenario-result">
                    <h4>Scenario Results</h4>
                    <p>Adjusting <span id="scenario-factor-name">Invasive Species Risk</span> to <span id="scenario-adjusted-value">50</span> would result in:</p>
                    
                    <div class="scenario-comparison">
                        <div class="scenario-comparison-item">
                            <div>Current Risk Score</div>
                            <div class="scenario-comparison-value" id="current-risk-score">0</div>
                            <div class="risk-level" id="current-risk-level">Low Risk</div>
                        </div>
                        <div class="scenario-comparison-item">
                            <div>Scenario Risk Score</div>
                            <div class="scenario-comparison-value" id="scenario-risk-score">0</div>
                            <div class="risk-level" id="scenario-risk-level">Low Risk</div>
                        </div>
                        <div class="scenario-comparison-item">
                            <div>Difference</div>
                            <div class="scenario-comparison-value" id="scenario-difference">0</div>
                            <div id="scenario-impact">No change</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Photo Upload Section -->
            <div class="form-group photo-upload">
                <label>Add Risk Evidence Photos: <span class="tooltip"><i class="fas fa-info-circle"></i>
                    <span class="tooltiptext">Upload or take photos of risk evidence</span>
                </span></label>
                <div class="photo-options">
                    <button type="button" class="button secondary-button" id="take-photo-btn-risk" aria-label="Take risk evidence photo">
                        <i class="fas fa-camera"></i> Take Photo
                    </button>
                    <button type="button" class="button secondary-button" id="upload-photo-btn-risk" aria-label="Upload risk evidence photo">
                        <i class="fas fa-upload"></i> Upload Photo
                    </button>
                </div>
                <div class="photo-preview-container" id="photo-preview-risk" aria-label="Risk evidence photos"></div>
                <input type="file" id="photo-input-risk" accept="image/*" capture="environment" style="display:none;" aria-hidden="true">
            </div>

            <!-- Notes Section -->
            <div class="form-group notes-section">
                <label for="risk-notes">Additional Risk Notes: <span class="tooltip"><i class="fas fa-info-circle"></i>
                    <span class="tooltiptext">Any additional observations about the risks</span>
                </span></label>
                <textarea id="risk-notes" rows="4" placeholder="Add any additional notes about the risks..." aria-label="Additional risk notes"></textarea>
            </div>

            <div class="navigation-buttons">
                <button type="button" class="button prev-button" onclick="prevSection('risk-section', 'site-section')">
                    <i class="fas fa-arrow-left"></i> Previous
                </button>
                <button type="button" class="button save-progress-button" id="save-progress-btn-risk">
                    <i class="fas fa-save"></i> Save Progress
                </button>
                <button type="button" class="button next-button" onclick="nextSection('risk-section', 'results-section')">
                    Next: Results <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </section>

        <!-- Results Section -->
        <section class="card" id="results-section">
            <h2><i class="fas fa-chart-bar"></i> Risk Assessment Results</h2>
            
            <div class="risk-summary">
                <div class="risk-score-container">
                    <h3>Overall Risk Score</h3>
                    <div class="risk-meter">
                        <div class="risk-meter-fill" id="risk-meter-fill"></div>
                    </div>
                    <div class="risk-score-display">
                        <span id="risk-score">0</span>
                        <span class="risk-level" id="risk-level">Low Risk</span>
                    </div>
                </div>
                
                <div class="risk-breakdown">
                    <h3>Risk Breakdown</h3>
                    <canvas id="impact-chart" aria-label="Risk breakdown chart"></canvas>
                </div>
            </div>

            <!-- Heat Map Visualization -->
            <div class="heat-map-container">
                <h3>Risk Heat Map</h3>
                <p>Visual representation of risk factors and their relative impact.</p>
                <div class="heat-map" id="heat-map"></div>
            </div>

            <div class="recommendations-container">
                <h3><i class="fas fa-lightbulb"></i> Recommendations</h3>
                <div id="recommendations" class="recommendations-list"></div>
            </div>

            <!-- Notes Section -->
            <div class="form-group notes-section">
                <label for="results-notes">Assessment Notes: <span class="tooltip"><i class="fas fa-info-circle"></i>
                    <span class="tooltiptext">Final notes and observations about the assessment</span>
                </span></label>
                <textarea id="results-notes" rows="4" placeholder="Add any final notes about the assessment..." aria-label="Assessment notes"></textarea>
            </div>

            <div class="action-buttons">
                <button id="generate-report" class="button primary-button" aria-label="Generate PDF report">
                    <i class="fas fa-file-pdf"></i> Generate PDF Report
                </button>
                <button id="save-local" class="button secondary-button" aria-label="Save as CSV">
                    <i class="fas fa-file-csv"></i> Save as CSV
                </button>
                <button id="new-assessment" class="button" aria-label="Start new assessment">
                    <i class="fas fa-plus"></i> New Assessment
                </button>
                <button id="delete-data" class="button danger-button" aria-label="Delete all data">
                    <i class="fas fa-trash-alt"></i> Delete Data
                </button>
            </div>

            <div class="navigation-buttons">
                <button type="button" class="button prev-button" onclick="prevSection('results-section', 'risk-section')">
                    <i class="fas fa-arrow-left"></i> Previous
                </button>
            </div>
        </section>

        <!-- Disclaimer Section -->
        <section class="card disclaimer">
            <h3><i class="fas fa-exclamation-circle"></i> Disclaimer</h3>
            <p>
                This tool is intended for informational purposes only. Users are responsible for ensuring regulatory compliance and accuracy of data provided. 
                The results should be reviewed by qualified biosecurity professionals before making any decisions.
            </p>
        </section>

        <!-- Footer -->
        <footer>
            <div class="footer-content">
                <p>Developed by Jay Rowley © 2025</p>
                <div class="footer-links">
                    <a href="#" id="privacy-policy">Privacy Policy</a>
                    <a href="#" id="terms-of-use">Terms of Use</a>
                    <a href="#" id="contact-support">Contact Support</a>
                </div>
            </div>
        </footer>
    </div>

    <!-- Privacy Policy Modal -->
    <div id="privacy-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Privacy Policy</h2>
            <p>This application stores all data locally in your browser and does not transmit any information to external servers. 
            Your assessment data remains on your device unless you explicitly choose to export it.</p>
            <p>For more information about our data handling practices, please contact us.</p>
        </div>
    </div>

    <!-- Terms of Use Modal -->
    <div id="terms-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Terms of Use</h2>
            <p>By using this Biosecurity Risk Assessment Tool, you agree to the following terms:</p>
            <ul>
                <li>This tool is provided for informational purposes only.</li>
                <li>The results should not be considered as professional advice.</li>
                <li>You are responsible for verifying the accuracy of the assessments.</li>
                <li>The developers are not liable for any decisions made based on this tool's outputs.</li>
            </ul>
            <p>Last updated: June 2025</p>
        </div>
    </div>

    <!-- Contact Support Modal -->
    <div id="contact-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Contact Support</h2>
            <p>For technical support or questions about this tool:</p>
            <p><i class="fas fa-envelope"></i> Email: support@biosecuritytool.example.com</p>
            <p><i class="fas fa-phone"></i> Phone: +1 (555) 123-4567</p>
            <p><i class="fas fa-clock"></i> Support Hours: Monday-Friday, 9AM-5PM EST</p>
            <p>We typically respond within 1-2 business days.</p>
        </div>
    </div>

    <!-- Confirmation Dialog -->
    <div id="confirmation-dialog" class="confirmation-dialog">
        <div class="confirmation-content">
            <h3>Unsaved Changes</h3>
            <p>You have unsaved changes. Are you sure you want to leave this page?</p>
            <div class="confirmation-buttons">
                <button id="confirm-cancel" class="button secondary-button">Cancel</button>
                <button id="confirm-leave" class="button primary-button">Leave Without Saving</button>
            </div>
        </div>
    </div>

    <!-- Welcome Modal -->
    <div id="welcome-modal" class="welcome-modal">
        <div class="welcome-content">
            <span class="close-modal">&times;</span>
            <h2>Welcome to the Biosecurity Risk Assessment Tool</h2>
            <p>This tool helps you assess and manage biosecurity risks for your projects. Follow these simple steps to get started:</p>
            
            <div class="welcome-steps">
                <div class="welcome-step">
                    <div class="welcome-step-number">1</div>
                    <div class="welcome-step-content">
                        <h4>Enter Project Details</h4>
                        <p>Start by providing basic information about your project, including location and assessor details.</p>
                    </div>
                </div>
                
                <div class="welcome-step">
                    <div class="welcome-step-number">2</div>
                    <div class="welcome-step-content">
                        <h4>Describe Site Information</h4>
                        <p>Provide details about the project site, including environmental features and accessibility.</p>
                    </div>
                </div>
                
                <div class="welcome-step">
                    <div class="welcome-step-number">3</div>
                    <div class="welcome-step-content">
                        <h4>Assess Risk Factors</h4>
                        <p>Evaluate different risk factors using the interactive sliders to get a comprehensive risk profile.</p>
                    </div>
                </div>
                
                <div class="welcome-step">
                    <div class="welcome-step-number">4</div>
                    <div class="welcome-step-content">
                        <h4>Review Results</h4>
                        <p>View your risk assessment results, including visualizations and customized recommendations.</p>
                    </div>
                </div>
            </div>
            
            <div class="action-buttons" style="margin-top: 30px;">
                <button id="start-assessment" class="button primary-button">Start Assessment</button>
                <button id="view-tutorial" class="button secondary-button">View Tutorial</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://unpkg.com/esri-leaflet@3.0.8/dist/esri-leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder@2.4.0/dist/Control.Geocoder.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <script>
        // DOM Elements
        const sections = ['project-section', 'site-section', 'risk-section', 'results-section'];
        let currentSection = 0;
        
        // Map variables
        let map;
        let marker;
        let currentLatLng = { lat: 0, lng: 0 };

        // Track unsaved changes
        let hasUnsavedChanges = false;
        let isInitialLoad = true;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize theme
            initTheme();
            
            // Show first section by default
            showSection(0);
            updateProgressBar();
            
            // Initialize the radar chart
            initializeRadarChart();
            
            // Initialize the heat map
            initializeHeatMap();
            
            // Set up event listeners
            setupEventListeners();
            
            // Set default date to today
            document.getElementById('date').valueAsDate = new Date();
            
            // Initialize the map
            initMap();
            
            // Set up photo capture
            setupPhotoCapture();
            
            // Load any saved data
            loadSavedData();
            
            // Show welcome modal on first visit
            if (localStorage.getItem('hasVisitedBefore') !== 'true') {
                setTimeout(() => {
                    document.getElementById('welcome-modal').style.display = 'block';
                    localStorage.setItem('hasVisitedBefore', 'true');
                }, 500);
            }
            
            // Track form changes for unsaved changes detection
            trackFormChanges();
        });

        // Theme management
        function initTheme() {
            const themeToggle = document.getElementById('theme-toggle');
            const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
            
            // Check for saved theme preference or use OS preference
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark' || (!savedTheme && prefersDarkScheme.matches)) {
                document.body.classList.add('dark-mode');
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            }
            
            // Theme toggle button
            themeToggle.addEventListener('click', function() {
                document.body.classList.toggle('dark-mode');
                const isDark = document.body.classList.contains('dark-mode');
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                themeToggle.innerHTML = isDark ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
                
                // Update map theme if needed
                if (map) {
                    setTimeout(() => {
                        map.invalidateSize();
                    }, 300);
                }
                
                // Update charts
                updateRadarChart();
                updateHeatMap();
            });
        }

        // Initialize Leaflet map
        function initMap() {
            // Default to Melbourne Australia 
            map = L.map('map').setView([-37.8136, 144.9631], 10);
            
            // Add OpenStreetMap tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
            
            // Initialize marker
            marker = L.marker([0, 0], {
                draggable: true
            }).addTo(map);
            
            // Add click event to update location
            map.on('click', function(e) {
                updateMapMarker(e.latlng);
                updateLocationInput(e.latlng);
            });
            
            // Add marker drag event
            marker.on('dragend', function(e) {
                const newLatLng = marker.getLatLng();
                updateLocationInput(newLatLng);
            });
            
            // Update coordinates display on map move
            map.on('move', function() {
                const center = map.getCenter();
                document.getElementById('coordinates-display').textContent = 
                    `Lat: ${center.lat.toFixed(4)}, Lng: ${center.lng.toFixed(4)}`;
            });
        }
        
        // Update map marker position
        function updateMapMarker(latlng) {
            currentLatLng = latlng;
            marker.setLatLng(latlng);
            map.setView(latlng, 12); // Zoom to a reasonable level
        }
        
        // Update location input field with coordinates
        function updateLocationInput(latlng) {
            document.getElementById('location').value = `${latlng.lat.toFixed(6)}, ${latlng.lng.toFixed(6)}`;
            document.getElementById('coordinates-display').textContent = 
                `Lat: ${latlng.lat.toFixed(4)}, Lng: ${latlng.lng.toFixed(4)}`;
            markAsChanged();
        }
        
        // Get user's current location
        function getCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        const latlng = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        updateMapMarker(latlng);
                        updateLocationInput(latlng);
                        
                        // Reverse geocode to get address
                        fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latlng.lat}&lon=${latlng.lng}`)
                            .then(response => response.json())
                            .then(data => {
                                if (data.display_name) {
                                    document.getElementById('location').value = data.display_name;
                                    markAsChanged();
                                }
                            })
                            .catch(error => {
                                console.error('Geocoding error:', error);
                            });
                    },
                    function(error) {
                        alert('Unable to get your location: ' + error.message);
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 5000,
                        maximumAge: 0
                    }
                );
            } else {
                alert('Geolocation is not supported by your browser.');
            }
        }
        
        // Search for location
        function searchLocation() {
            const query = prompt('Enter an address or place name:');
            if (query) {
                fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.length > 0) {
                            const latlng = {
                                lat: parseFloat(data[0].lat),
                                lng: parseFloat(data[0].lon)
                            };
                            updateMapMarker(latlng);
                            updateLocationInput(latlng);
                            document.getElementById('location').value = data[0].display_name;
                            markAsChanged();
                        } else {
                            alert('Location not found.');
                        }
                    })
                    .catch(error => {
                        console.error('Search error:', error);
                        alert('Error searching for location.');
                    });
            }
        }

        // Navigation Functions
        function showSection(index) {
            sections.forEach((section, i) => {
                const el = document.getElementById(section);
                if (i === index) {
                    el.classList.add('active');
                    // Set focus to first focusable element for better keyboard navigation
                    setTimeout(() => {
                        const focusable = el.querySelector('input, select, textarea, button');
                        if (focusable) focusable.focus();
                    }, 100);
                } else {
                    el.classList.remove('active');
                }
            });
            currentSection = index;
            updateProgressBar();
            
            // Resize map when section becomes active
            if (index === 0 && map) {
                setTimeout(() => {
                    map.invalidateSize();
                }, 300);
            }
            
            // Load photos for current section
            loadPhotosFromLocalStorage();
            
            // Update heat map when results section is shown
            if (index === 3) {
                updateHeatMap();
            }
        }

        function nextSection(currentId, nextId) {
            if (validateSection(currentId)) {
                const currentIndex = sections.indexOf(currentId);
                const nextIndex = sections.indexOf(nextId);
                showSection(nextIndex);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function prevSection(currentId, prevId) {
            const currentIndex = sections.indexOf(currentId);
            const prevIndex = sections.indexOf(prevId);
            showSection(prevIndex);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function validateSection(sectionId) {
            const section = document.getElementById(sectionId);
            const requiredInputs = section.querySelectorAll('[required]');
            let isValid = true;

            requiredInputs.forEach(input => {
                if (!input.value.trim()) {
                    input.classList.add('error');
                    isValid = false;
                    
                    // Add error message if not already present
                    if (!input.nextElementSibling || !input.nextElementSibling.classList.contains('error-message')) {
                        const errorMsg = document.createElement('span');
                        errorMsg.className = 'error-message';
                        errorMsg.textContent = 'This field is required';
                        input.parentNode.insertBefore(errorMsg, input.nextSibling);
                    }
                } else {
                    input.classList.remove('error');
                    const errorMsg = input.nextElementSibling;
                    if (errorMsg && errorMsg.classList.contains('error-message')) {
                        errorMsg.remove();
                    }
                }
            });

            // Additional validation for numeric fields
            const numericInputs = section.querySelectorAll('input[type="number"]');
            numericInputs.forEach(input => {
                if (input.value && isNaN(input.value)) {
                    input.classList.add('error');
                    isValid = false;
                    
                    if (!input.nextElementSibling || !input.nextElementSibling.classList.contains('error-message')) {
                        const errorMsg = document.createElement('span');
                        errorMsg.className = 'error-message';
                        errorMsg.textContent = 'Please enter a valid number';
                        input.parentNode.insertBefore(errorMsg, input.nextSibling);
                    }
                }
            });

            if (!isValid) {
                // Scroll to first error
                const firstError = section.querySelector('.error');
                if (firstError) {
                    firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
                return false;
            }
            return true;
        }

        function updateProgressBar() {
            const progress = (currentSection / (sections.length - 1)) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
            
            // Update step indicators
            document.querySelectorAll('.progress-step').forEach((step, index) => {
                if (index <= currentSection) {
                    step.classList.add('active');
                    step.classList.add('completed');
                } else {
                    step.classList.remove('active');
                    step.classList.remove('completed');
                }
                
                if (index === currentSection) {
                    step.classList.add('current');
                } else {
                    step.classList.remove('current');
                }
            });
        }

        // Slider Functions
        function setupSliderListeners() {
            document.querySelectorAll("input[type='range']").forEach(slider => {
                slider.addEventListener("input", function() {
                    const sliderValue = this.nextElementSibling;
                    sliderValue.textContent = this.value;
                    
                    // Update visual feedback based on value
                    const value = parseInt(this.value);
                    if (value > 70) {
                        this.classList.add('high-risk');
                        this.classList.remove('medium-risk', 'low-risk');
                    } else if (value > 30) {
                        this.classList.add('medium-risk');
                        this.classList.remove('high-risk', 'low-risk');
                    } else {
                        this.classList.add('low-risk');
                        this.classList.remove('high-risk', 'medium-risk');
                    }
                    
                    updateRiskScore();
                    updateRecommendations();
                    updateRadarChart();
                    markAsChanged();
                });
                
                // Trigger initial update
                slider.dispatchEvent(new Event('input'));
            });
        }

        // Risk Calculation Functions
        function updateRiskScore() {
            let totalScore = 0;
            
            document.querySelectorAll("input[type='range']").forEach(slider => {
                const weight = parseFloat(slider.dataset.weight) || 1;
                totalScore += parseInt(slider.value) * weight;
            });
            
            // Cap the score at 100
            totalScore = Math.min(Math.round(totalScore), 100);
            
            const riskScoreElement = document.getElementById('risk-score');
            riskScoreElement.textContent = totalScore;
            
            const riskLevelElement = document.getElementById('risk-level');
            const riskMeterFill = document.getElementById('risk-meter-fill');
            
            if (totalScore <= 30) {
                riskLevelElement.textContent = "Low Risk";
                riskLevelElement.className = "risk-level low";
                riskMeterFill.className = "risk-meter-fill low";
                riskMeterFill.style.width = `${totalScore}%`;
            } else if (totalScore <= 60) {
                riskLevelElement.textContent = "Moderate Risk";
                riskLevelElement.className = "risk-level medium";
                riskMeterFill.className = "risk-meter-fill medium";
                riskMeterFill.style.width = `${totalScore}%`;
            } else {
                riskLevelElement.textContent = "High Risk";
                riskLevelElement.className = "risk-level high";
                riskMeterFill.className = "risk-meter-fill high";
                riskMeterFill.style.width = `${totalScore}%`;
            }
        }

        // Heat Map Functions
        function initializeHeatMap() {
            const heatMap = document.getElementById('heat-map');
            heatMap.innerHTML = '';
            
            const riskFactors = [
                { id: 'invasive-species', name: 'Invasive Species', weight: 0.28 },
                { id: 'pathogen-spread', name: 'Pathogen Spread', weight: 0.22 },
                { id: 'contamination', name: 'Contamination', weight: 0.18 },
                { id: 'transportation', name: 'Transportation', weight: 0.12 },
                { id: 'quarantine-breach', name: 'Quarantine Breach', weight: 0.10 },
                { id: 'training-compliance', name: 'Training', weight: 0.10 },
                { id: 'supply-chain', name: 'Supply Chain', weight: 0.10 }
            ];
            
            // Create 5x5 grid for visualization
            const gridSize = 5;
            const totalCells = gridSize * gridSize;
            
            // Calculate cell weights based on risk factor weights
            const cellWeights = [];
            let remainingWeight = 1;
            
            // Distribute weights to cells based on risk factor weights
            riskFactors.forEach(factor => {
                const cellsForFactor = Math.max(1, Math.round(factor.weight * totalCells));
                const weightPerCell = factor.weight / cellsForFactor;
                
                for (let i = 0; i < cellsForFactor; i++) {
                    cellWeights.push({
                        factor: factor,
                        weight: weightPerCell
                    });
                }
                
                remainingWeight -= factor.weight;
            });
            
            // Fill remaining cells with neutral weight
            while (cellWeights.length < totalCells) {
                cellWeights.push({
                    factor: null,
                    weight: 0
                });
            }
            
            // Shuffle cells for better visual distribution
            for (let i = cellWeights.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [cellWeights[i], cellWeights[j]] = [cellWeights[j], cellWeights[i]];
            }
            
            // Create heat map rows and cells
            for (let row = 0; row < gridSize; row++) {
                const heatMapRow = document.createElement('div');
                heatMapRow.className = 'heat-map-row';
                
                for (let col = 0; col < gridSize; col++) {
                    const index = row * gridSize + col;
                    const cellData = cellWeights[index];
                    
                    const cell = document.createElement('div');
                    cell.className = 'heat-map-cell';
                    
                    if (cellData.factor) {
                        const value = parseInt(document.getElementById(cellData.factor.id).value);
                        const weightedValue = value * cellData.weight;
                        
                        // Set color based on weighted value
                        let color, textColor = '#fff';
                        
                        if (weightedValue > 70 * cellData.weight) {
                            color = '#d32f2f'; // Red
                        } else if (weightedValue > 30 * cellData.weight) {
                            color = '#ffa000'; // Orange
                        } else {
                            color = '#388e3c'; // Green
                        }
                        
                        cell.style.backgroundColor = color;
                        cell.style.color = textColor;
                        
                        // Add tooltip
                        const tooltip = document.createElement('div');
                        tooltip.className = 'cell-tooltip';
                        tooltip.textContent = `${cellData.factor.name}: ${value}`;
                        cell.appendChild(tooltip);
                    } else {
                        cell.style.backgroundColor = '#f5f5f5';
                        cell.style.color = '#333';
                        
                        if (document.body.classList.contains('dark-mode')) {
                            cell.style.backgroundColor = '#444';
                            cell.style.color = '#e0e0e0';
                        }
                    }
                    
                    heatMapRow.appendChild(cell);
                }
                
                heatMap.appendChild(heatMapRow);
            }
        }
        
        function updateHeatMap() {
            initializeHeatMap(); // For simplicity, we're regenerating the heat map
        }

        // Scenario Modeling Functions
        function setupScenarioModeling() {
            const scenarioFactor = document.getElementById('scenario-factor');
            const scenarioValue = document.getElementById('scenario-value');
            const scenarioValueDisplay = document.getElementById('scenario-value-display');
            const runScenarioBtn = document.getElementById('run-scenario');
            
            // Update scenario value display
            scenarioValue.addEventListener('input', function() {
                scenarioValueDisplay.textContent = this.value;
            });
            
            // Update factor name when selection changes
            scenarioFactor.addEventListener('change', function() {
                const selectedOption = this.options[this.selectedIndex];
                document.getElementById('scenario-factor-name').textContent = selectedOption.text;
            });
            
            // Run scenario when button is clicked
            runScenarioBtn.addEventListener('click', function() {
                const selectedFactor = scenarioFactor.value;
                const scenarioValue = parseInt(document.getElementById('scenario-value').value);
                
                // Get current values
                const currentValues = {};
                let currentScore = 0;
                
                document.querySelectorAll("input[type='range']").forEach(slider => {
                    currentValues[slider.id] = parseInt(slider.value);
                    const weight = parseFloat(slider.dataset.weight) || 1;
                    currentScore += parseInt(slider.value) * weight;
                });
                
                // Calculate scenario score
                let scenarioScore = 0;
                
                document.querySelectorAll("input[type='range']").forEach(slider => {
                    const weight = parseFloat(slider.dataset.weight) || 1;
                    if (slider.id === selectedFactor) {
                        scenarioScore += scenarioValue * weight;
                    } else {
                        scenarioScore += currentValues[slider.id] * weight;
                    }
                });
                
                // Cap the scores at 100
                currentScore = Math.min(Math.round(currentScore), 100);
                scenarioScore = Math.min(Math.round(scenarioScore), 100);
                
                // Update scenario results
                document.getElementById('current-risk-score').textContent = currentScore;
                document.getElementById('scenario-risk-score').textContent = scenarioScore;
                document.getElementById('scenario-adjusted-value').textContent = scenarioValue;
                document.getElementById('scenario-difference').textContent = scenarioScore - currentScore;
                
                // Set risk levels
                setRiskLevel('current-risk-level', currentScore);
                setRiskLevel('scenario-risk-level', scenarioScore);
                
                // Set impact description
                const difference = scenarioScore - currentScore;
                let impactText = '';
                
                if (difference > 15) {
                    impactText = 'Significant increase in risk';
                } else if (difference > 5) {
                    impactText = 'Moderate increase in risk';
                } else if (difference > -5) {
                    impactText = 'Minimal change in risk';
                } else if (difference > -15) {
                    impactText = 'Moderate decrease in risk';
                } else {
                    impactText = 'Significant decrease in risk';
                }
                
                document.getElementById('scenario-impact').textContent = impactText;
                
                // Show results
                document.getElementById('scenario-result').classList.add('active');
            });
        }
        
        function setRiskLevel(elementId, score) {
            const element = document.getElementById(elementId);
            
            if (score <= 30) {
                element.textContent = "Low Risk";
                element.className = "risk-level low";
            } else if (score <= 60) {
                element.textContent = "Moderate Risk";
                element.className = "risk-level medium";
            } else {
                element.textContent = "High Risk";
                element.className = "risk-level high";
            }
        }

        // Recommendation Engine
        function updateRecommendations() {
            const recommendations = [];
            const riskFactors = [];
            
            // Risk factor specific recommendations
            if (parseInt(document.getElementById("invasive-species").value) > 50) {
                riskFactors.push("Invasive Species");
                recommendations.push(
                    "Implement decontamination protocols for equipment and personnel entering and leaving the site.",
                    "Establish monitoring programs for early detection of invasive species.",
                    "Consider using native species in any revegetation efforts to reduce invasive species pressure."
                );
            }
            
            if (parseInt(document.getElementById("pathogen-spread").value) > 50) {
                riskFactors.push("Pathogen Spread");
                recommendations.push(
                    "Enforce strict quarantine measures for personnel, equipment, and materials entering the site.",
                    "Implement biosecurity zones with controlled access points.",
                    "Establish sanitation stations at all entry and exit points."
                );
            }
            
            if (parseInt(document.getElementById("contamination").value) > 50) {
                riskFactors.push("Contamination");
                recommendations.push(
                    "Establish buffer zones around sensitive areas to prevent contamination.",
                    "Implement strict waste management protocols for biological materials.",
                    "Conduct regular environmental monitoring for contaminants."
                );
            }
            
            if (parseInt(document.getElementById("transportation").value) > 50) {
                riskFactors.push("Transportation");
                recommendations.push(
                    "Limit non-essential transportation to and from the site.",
                    "Implement vehicle washing stations for all vehicles leaving the site.",
                    "Establish designated routes for transportation to minimize environmental impact."
                );
            }
            
            if (parseInt(document.getElementById("quarantine-breach").value) > 50) {
                riskFactors.push("Quarantine Breach");
                recommendations.push(
                    "Strengthen quarantine protocols with physical barriers and monitoring systems.",
                    "Implement double-gate systems for any material transfers.",
                    "Conduct regular audits of quarantine procedures."
                );
            }
            
            const trainingComplianceValue = parseInt(document.getElementById("training-compliance").value);
            if (trainingComplianceValue > 50) {
                riskFactors.push("Training Compliance");
                recommendations.push(
                    "High-risk detected in biosecurity training compliance—mandatory workshops and stricter monitoring recommended.",
                    "Implement a certification system for biosecurity training.",
                    "Conduct regular refresher courses and competency assessments."
                );
            } else if (trainingComplianceValue < 50) {
                recommendations.push(
                    "Increase frequency and comprehensiveness of biosecurity training programs.",
                    "Implement a tracking system to ensure all personnel complete required training.",
                    "Consider linking training completion to site access privileges."
                );
            }
            
            if (parseInt(document.getElementById("supply-chain").value) > 50) {
                riskFactors.push("Supply Chain");
                recommendations.push(
                    "Conduct audits on suppliers to verify their biosecurity practices.",
                    "Enforce stricter import protocols including certification requirements.",
                    "Establish an approved supplier program with biosecurity requirements."
                );
            }
            
            // Contextual recommendations based on site information
            const distanceEcosystem = parseInt(document.getElementById("distance-ecosystem").value) || 0;
            if (distanceEcosystem < 5) {
                recommendations.push(
                    "Site is near sensitive ecosystems—enhanced protection measures recommended including increased buffer zones.",
                    "Consider implementing additional monitoring for ecosystem impacts.",
                    "Schedule operations to avoid sensitive periods for nearby ecosystems (e.g., breeding seasons)."
                );
            }
            
            const landUseHistory = document.getElementById("land-use-history").value.trim().toLowerCase();
            if (landUseHistory.includes("farming") || landUseHistory.includes("agricultur")) {
                recommendations.push(
                    "Previous agricultural use detected—conduct soil and water quality tests for residual chemicals.",
                    "Monitor for invasive species that may be associated with previous agricultural activities.",
                    "Consider phytoremediation if soil contamination is suspected."
                );
            }
            
            if (landUseHistory.includes("industrial")) {
                recommendations.push(
                    "Previous industrial use detected—conduct comprehensive soil and water testing for contaminants.",
                    "Implement additional containment measures if working with deep soil or groundwater.",
                    "Consider specialist consultation for potential legacy contamination issues."
                );
            }
            
            const currentActivities = document.getElementById("current-activities").value.trim().toLowerCase();
            if (currentActivities.includes("construction")) {
                recommendations.push(
                    "Construction activities present—implement dust control measures to prevent pathogen spread.",
                    "Establish vehicle and equipment cleaning protocols to prevent soil transfer.",
                    "Monitor for invasive species that may take advantage of disturbed ground."
                );
            }
            
            // Display recommendations
            const recommendationsContainer = document.getElementById("recommendations");
            
            if (recommendations.length > 0) {
                let html = '<div class="risk-factors"><strong>Key Risk Factors:</strong> ';
                html += riskFactors.join(', ') + '</div>';
                html += '<ul class="recommendations">';
                
                // Remove duplicates while preserving order
                const uniqueRecommendations = [];
                recommendations.forEach(rec => {
                    if (!uniqueRecommendations.includes(rec)) {
                        uniqueRecommendations.push(rec);
                        html += `<li>${rec}</li>`;
                    }
                });
                
                html += '</ul>';
                recommendationsContainer.innerHTML = html;
            } else {
                recommendationsContainer.innerHTML = `
                    <div class="no-risks">
                        <i class="fas fa-check-circle"></i>
                        <p>No significant risks detected. Regular monitoring recommended.</p>
                    </div>
                `;
            }
        }

        // Chart Functions
        let radarChart = null;

        function initializeRadarChart() {
            const ctx = document.getElementById('impact-chart').getContext('2d');
            
            radarChart = new Chart(ctx, {
                type: 'radar',
                data: getChartData(),
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: {
                                display: true,
                                color: document.body.classList.contains('dark-mode') ? 'rgba(200, 200, 200, 0.1)' : 'rgba(0, 0, 0, 0.1)'
                            },
                            suggestedMin: 0,
                            suggestedMax: 100,
                            ticks: {
                                stepSize: 20,
                                backdropColor: document.body.classList.contains('dark-mode') ? 'rgba(50, 50, 50, 0.75)' : 'rgba(255, 255, 255, 0.75)'
                            },
                            pointLabels: {
                                font: {
                                    size: 11
                                },
                                color: document.body.classList.contains('dark-mode') ? '#e0e0e0' : '#4a4a4a'
                            },
                            grid: {
                                color: document.body.classList.contains('dark-mode') ? 'rgba(200, 200, 200, 0.1)' : 'rgba(0, 0, 0, 0.1)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.raw}%`;
                                }
                            }
                        }
                    },
                    elements: {
                        line: {
                            tension: 0.1
                        }
                    }
                }
            });
        }

        function updateRadarChart() {
            if (radarChart) {
                radarChart.data = getChartData();
                radarChart.options.scales.r.angleLines.color = document.body.classList.contains('dark-mode') ? 'rgba(200, 200, 200, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                radarChart.options.scales.r.ticks.backdropColor = document.body.classList.contains('dark-mode') ? 'rgba(50, 50, 50, 0.75)' : 'rgba(255, 255, 255, 0.75)';
                radarChart.options.scales.r.pointLabels.color = document.body.classList.contains('dark-mode') ? '#e0e0e0' : '#4a4a4a';
                radarChart.options.scales.r.grid.color = document.body.classList.contains('dark-mode') ? 'rgba(200, 200, 200, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                radarChart.update();
            }
        }

        function getChartData() {
            return {
                labels: [
                    "Invasive Species", 
                    "Pathogen Spread", 
                    "Contamination", 
                    "Transportation", 
                    "Quarantine Breach", 
                    "Training", 
                    "Supply Chain"
                ],
                datasets: [{
                    label: 'Risk Level',
                    data: [
                        parseInt(document.getElementById('invasive-species').value),
                        parseInt(document.getElementById('pathogen-spread').value),
                        parseInt(document.getElementById('contamination').value),
                        parseInt(document.getElementById('transportation').value),
                        parseInt(document.getElementById('quarantine-breach').value),
                        parseInt(document.getElementById('training-compliance').value),
                        parseInt(document.getElementById('supply-chain').value)
                    ],
                    backgroundColor: document.body.classList.contains('dark-mode') ? 'rgba(77, 184, 167, 0.2)' : 'rgba(0, 122, 108, 0.2)',
                    borderColor: document.body.classList.contains('dark-mode') ? 'rgba(77, 184, 167, 1)' : 'rgba(0, 122, 108, 1)',
                    pointBackgroundColor: document.body.classList.contains('dark-mode') ? 'rgba(77, 184, 167, 1)' : 'rgba(0, 122, 108, 1)',
                    pointBorderColor: document.body.classList.contains('dark-mode') ? '#333' : '#fff',
                    pointHoverBackgroundColor: document.body.classList.contains('dark-mode') ? '#333' : '#fff',
                    pointHoverBorderColor: document.body.classList.contains('dark-mode') ? 'rgba(77, 184, 167, 1)' : 'rgba(0, 122, 108, 1)',
                    borderWidth: 2,
                    pointRadius: 4
                }]
            };
        }

        // Photo Capture Functionality
        function setupPhotoCapture() {
            // Project section photo capture
            const takePhotoBtn = document.getElementById('take-photo-btn');
            const uploadPhotoBtn = document.getElementById('upload-photo-btn');
            const photoInput = document.getElementById('photo-input');
            const photoPreview = document.getElementById('photo-preview');
            
            setupPhotoButtons(takePhotoBtn, uploadPhotoBtn, photoInput, photoPreview, 'project');
            
            // Site section photo capture
            const takePhotoBtnSite = document.getElementById('take-photo-btn-site');
            const uploadPhotoBtnSite = document.getElementById('upload-photo-btn-site');
            const photoInputSite = document.getElementById('photo-input-site');
            const photoPreviewSite = document.getElementById('photo-preview-site');
            
            setupPhotoButtons(takePhotoBtnSite, uploadPhotoBtnSite, photoInputSite, photoPreviewSite, 'site');
            
            // Risk section photo capture
            const takePhotoBtnRisk = document.getElementById('take-photo-btn-risk');
            const uploadPhotoBtnRisk = document.getElementById('upload-photo-btn-risk');
            const photoInputRisk = document.getElementById('photo-input-risk');
            const photoPreviewRisk = document.getElementById('photo-preview-risk');
            
            setupPhotoButtons(takePhotoBtnRisk, uploadPhotoBtnRisk, photoInputRisk, photoPreviewRisk, 'risk');
        }
        
        function setupPhotoButtons(takeBtn, uploadBtn, input, preview, section) {
            takeBtn.addEventListener('click', () => {
                input.setAttribute('capture', 'environment');
                input.click();
            });
            
            uploadBtn.addEventListener('click', () => {
                input.removeAttribute('capture');
                input.click();
            });
            
            input.addEventListener('change', function(e) {
                const files = e.target.files;
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    if (file.type.match('image.*')) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const photoDiv = document.createElement('div');
                            photoDiv.className = 'photo-preview';
                            
                            const img = document.createElement('img');
                            img.src = e.target.result;
                            img.alt = `${section} photo ${i + 1}`;
                            
                            const deleteBtn = document.createElement('button');
                            deleteBtn.className = 'delete-photo';
                            deleteBtn.innerHTML = '<i class="fas fa-times"></i>';
                            deleteBtn.setAttribute('aria-label', `Delete ${section} photo ${i + 1}`);
                            deleteBtn.addEventListener('click', () => {
                                photoDiv.remove();
                                savePhotosToLocalStorage(section);
                                markAsChanged();
                            });
                            
                            photoDiv.appendChild(img);
                            photoDiv.appendChild(deleteBtn);
                            preview.appendChild(photoDiv);
                            
                            savePhotosToLocalStorage(section);
                            markAsChanged();
                        }
                        reader.readAsDataURL(file);
                    }
                }
                // Reset input to allow selecting same file again
                input.value = '';
            });
        }
        
        function savePhotosToLocalStorage(section) {
            let previewId;
            switch(section) {
                case 'project':
                    previewId = 'photo-preview';
                    break;
                case 'site':
                    previewId = 'photo-preview-site';
                    break;
                case 'risk':
                    previewId = 'photo-preview-risk';
                    break;
                default:
                    return;
            }
            
            const photoPreview = document.getElementById(previewId);
            const photos = [];
            
            photoPreview.querySelectorAll('img').forEach(img => {
                photos.push(img.src);
            });
            
            // Save to localStorage with section identifier
            const currentData = JSON.parse(localStorage.getItem('biosecurityAssessmentData') || '{}');
            currentData.photos = currentData.photos || {};
            currentData.photos[section] = photos;
            localStorage.setItem('biosecurityAssessmentData', JSON.stringify(currentData));
        }
        
        function loadPhotosFromLocalStorage() {
            const currentData = JSON.parse(localStorage.getItem('biosecurityAssessmentData') || '{}');
            if (!currentData.photos) return;
            
            // Determine which section we're in and load appropriate photos
            let previewId, section;
            switch(currentSection) {
                case 0: // Project section
                    previewId = 'photo-preview';
                    section = 'project';
                    break;
                case 1: // Site section
                    previewId = 'photo-preview-site';
                    section = 'site';
                    break;
                case 2: // Risk section
                    previewId = 'photo-preview-risk';
                    section = 'risk';
                    break;
                default:
                    return;
            }
            
            const photoPreview = document.getElementById(previewId);
            if (!photoPreview) return;
            
            photoPreview.innerHTML = '';
            
            if (currentData.photos[section]) {
                currentData.photos[section].forEach((photoSrc, index) => {
                    const photoDiv = document.createElement('div');
                    photoDiv.className = 'photo-preview';
                    
                    const img = document.createElement('img');
                    img.src = photoSrc;
                    img.alt = `${section} photo ${index + 1}`;
                    
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'delete-photo';
                    deleteBtn.innerHTML = '<i class="fas fa-times"></i>';
                    deleteBtn.setAttribute('aria-label', `Delete ${section} photo ${index + 1}`);
                    deleteBtn.addEventListener('click', () => {
                        photoDiv.remove();
                        savePhotosToLocalStorage(section);
                        markAsChanged();
                    });
                    
                    photoDiv.appendChild(img);
                    photoDiv.appendChild(deleteBtn);
                    photoPreview.appendChild(photoDiv);
                });
            }
        }

        // Data Management Functions
        function saveDataToLocalStorage() {
            const data = {
                projectDetails: {
                    name: document.getElementById('project-name').value,
                    location: document.getElementById('location').value,
                    coordinates: currentLatLng,
                    assessor: document.getElementById('assessor-name').value,
                    date: document.getElementById('date').value,
                    description: document.getElementById('project-description').value,
                    purpose: document.getElementById('project-purpose').value
                },
                siteInfo: {
                    floraFauna: document.getElementById('flora-fauna').value,
                    environmentalFeatures: Array.from(document.getElementById('environmental-features').selectedOptions)
                        .map(option => option.value),
                    distanceEcosystem: document.getElementById('distance-ecosystem').value,
                    distanceInfrastructure: document.getElementById('distance-infrastructure').value,
                    landUseHistory: document.getElementById('land-use-history').value,
                    currentActivities: document.getElementById('current-activities').value,
                    accessibility: document.getElementById('accessibility').value,
                    siteNotes: document.getElementById('site-notes').value
                },
                riskMetrics: {
                    invasiveSpecies: document.getElementById('invasive-species').value,
                    pathogenSpread: document.getElementById('pathogen-spread').value,
                    contamination: document.getElementById('contamination').value,
                    transportation: document.getElementById('transportation').value,
                    quarantineBreach: document.getElementById('quarantine-breach').value,
                    trainingCompliance: document.getElementById('training-compliance').value,
                    supplyChain: document.getElementById('supply-chain').value,
                    riskNotes: document.getElementById('risk-notes').value
                },
                resultsNotes: document.getElementById('results-notes').value,
                photos: {},
                theme: document.body.classList.contains('dark-mode') ? 'dark' : 'light'
            };
            
            // Save photos from all sections
            ['project', 'site', 'risk'].forEach(section => {
                let previewId;
                switch(section) {
                    case 'project':
                        previewId = 'photo-preview';
                        break;
                    case 'site':
                        previewId = 'photo-preview-site';
                        break;
                    case 'risk':
                        previewId = 'photo-preview-risk';
                        break;
                }
                
                const photoPreview = document.getElementById(previewId);
                if (photoPreview) {
                    data.photos[section] = Array.from(photoPreview.querySelectorAll('img')).map(img => img.src);
                }
            });
            
            localStorage.setItem('biosecurityAssessmentData', JSON.stringify(data));
            hasUnsavedChanges = false;
            
            // Show save confirmation
            const saveButtons = document.querySelectorAll('.save-progress-button');
            saveButtons.forEach(button => {
                const originalText = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check"></i> Saved!';
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                }, 2000);
            });
        }

        function loadSavedData() {
            const savedData = localStorage.getItem('biosecurityAssessmentData');
            if (savedData) {
                const data = JSON.parse(savedData);
                
                // Restore theme if saved
                if (data.theme === 'dark') {
                    document.body.classList.add('dark-mode');
                    document.getElementById('theme-toggle').innerHTML = '<i class="fas fa-sun"></i>';
                }
                
                // Project Details
                if (data.projectDetails) {
                    document.getElementById('project-name').value = data.projectDetails.name || '';
                    document.getElementById('location').value = data.projectDetails.location || '';
                    document.getElementById('assessor-name').value = data.projectDetails.assessor || '';
                    document.getElementById('date').value = data.projectDetails.date || '';
                    document.getElementById('project-description').value = data.projectDetails.description || '';
                    document.getElementById('project-purpose').value = data.projectDetails.purpose || '';
                    
                    // Restore map position if coordinates exist
                    if (data.projectDetails.coordinates) {
                        currentLatLng = data.projectDetails.coordinates;
                        updateMapMarker(currentLatLng);
                        updateLocationInput(currentLatLng);
                    }
                }
                
                // Site Information
                if (data.siteInfo) {
                    document.getElementById('flora-fauna').value = data.siteInfo.floraFauna || '';
                    
                    if (data.siteInfo.environmentalFeatures) {
                        const featuresSelect = document.getElementById('environmental-features');
                        Array.from(featuresSelect.options).forEach(option => {
                            option.selected = data.siteInfo.environmentalFeatures.includes(option.value);
                        });
                    }
                    
                    document.getElementById('distance-ecosystem').value = data.siteInfo.distanceEcosystem || '';
                    document.getElementById('distance-infrastructure').value = data.siteInfo.distanceInfrastructure || '';
                    document.getElementById('land-use-history').value = data.siteInfo.landUseHistory || '';
                    document.getElementById('current-activities').value = data.siteInfo.currentActivities || '';
                    document.getElementById('accessibility').value = data.siteInfo.accessibility || '';
                    document.getElementById('site-notes').value = data.siteInfo.siteNotes || '';
                }
                
                // Risk Metrics
                if (data.riskMetrics) {
                    document.getElementById('invasive-species').value = data.riskMetrics.invasiveSpecies || '0';
                    document.getElementById('pathogen-spread').value = data.riskMetrics.pathogenSpread || '0';
                    document.getElementById('contamination').value = data.riskMetrics.contamination || '0';
                    document.getElementById('transportation').value = data.riskMetrics.transportation || '0';
                    document.getElementById('quarantine-breach').value = data.riskMetrics.quarantineBreach || '0';
                    document.getElementById('training-compliance').value = data.riskMetrics.trainingCompliance || '0';
                    document.getElementById('supply-chain').value = data.riskMetrics.supplyChain || '0';
                    document.getElementById('risk-notes').value = data.riskMetrics.riskNotes || '';
                    
                    // Trigger updates for sliders
                    document.querySelectorAll("input[type='range']").forEach(slider => {
                        slider.dispatchEvent(new Event('input'));
                    });
                }
                
                // Results Notes
                if (data.resultsNotes) {
                    document.getElementById('results-notes').value = data.resultsNotes || '';
                }
                
                // Photos will be loaded when the section is shown
            }
        }

        function saveDataToCSV() {
            const headers = [
                "Category", "Field", "Value"
            ];

            const data = [
                ["Project Details", "Project Name", document.getElementById("project-name").value || "N/A"],
                ["Project Details", "Location", document.getElementById("location").value || "N/A"],
                ["Project Details", "Coordinates", `${currentLatLng.lat.toFixed(6)}, ${currentLatLng.lng.toFixed(6)}`],
                ["Project Details", "Assessor Name", document.getElementById("assessor-name").value || "N/A"],
                ["Project Details", "Date of Assessment", document.getElementById("date").value || "N/A"],
                ["Project Details", "Project Description", document.getElementById("project-description").value || "N/A"],
                ["Project Details", "Project Purpose", document.getElementById("project-purpose").value || "N/A"],
                
                ["Site Information", "Flora & Fauna", document.getElementById("flora-fauna").value || "N/A"],
                ["Site Information", "Environmental Features", Array.from(document.getElementById("environmental-features").selectedOptions)
                    .map(option => option.value).join(", ") || "N/A"],
                ["Site Information", "Distance to Sensitive Ecosystems (km)", document.getElementById("distance-ecosystem").value || "N/A"],
                ["Site Information", "Distance to Critical Infrastructure (km)", document.getElementById("distance-infrastructure").value || "N/A"],
                ["Site Information", "Land Use History", document.getElementById("land-use-history").value || "N/A"],
                ["Site Information", "Current Site Activities", document.getElementById("current-activities").value || "N/A"],
                ["Site Information", "Site Accessibility", document.getElementById("accessibility").value || "N/A"],
                ["Site Information", "Site Notes", document.getElementById("site-notes").value || "N/A"],
                
                ["Risk Metrics", "Invasive Species Risk", document.getElementById("invasive-species").value || "0"],
                ["Risk Metrics", "Pathogen Spread Risk", document.getElementById("pathogen-spread").value || "0"],
                ["Risk Metrics", "Contamination Risk", document.getElementById("contamination").value || "0"],
                ["Risk Metrics", "Transportation Risk", document.getElementById("transportation").value || "0"],
                ["Risk Metrics", "Quarantine Breach Risk", document.getElementById("quarantine-breach").value || "0"],
                ["Risk Metrics", "Training Compliance", document.getElementById("training-compliance").value || "0"],
                ["Risk Metrics", "Supply Chain Risk", document.getElementById("supply-chain").value || "0"],
                ["Risk Metrics", "Risk Notes", document.getElementById("risk-notes").value || "N/A"],
                
                ["Risk Assessment", "Total Risk Score", document.getElementById("risk-score").textContent || "0"],
                ["Risk Assessment", "Risk Level", document.getElementById("risk-level").textContent || "Low Risk"],
                ["Risk Assessment", "Results Notes", document.getElementById("results-notes").value || "N/A"]
            ];

            const csvContent = [
                headers.join(","),
                ...data.map(row => row.map(field => `"${field.replace(/"/g, '""')}"`).join(","))
            ].join("\n");

            const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
            saveAs(blob, `Biosecurity_Risk_Assessment_${new Date().toISOString().slice(0,10)}.csv`);
        }

        async function generatePDFReport() {
            const { jsPDF } = window.jspdf;
            
            // Ask for report name
            const defaultName = document.getElementById("project-name").value 
                ? `Biosecurity_Report_${document.getElementById("project-name").value.replace(/[^a-z0-9]/gi, '_')}`
                : "Biosecurity_Risk_Report";
            
            const pdfName = prompt("Enter the file name for your PDF:", defaultName);
            
            // Check if user canceled the prompt (pdfName will be null)
            if (pdfName === null) {
                return; // Exit the function if user canceled
            }
            
            // If user clicked OK but left the field empty, use the default name
            const finalPdfName = pdfName.trim() === "" ? defaultName : pdfName;

            try {
                const doc = new jsPDF({
                    orientation: "portrait",
                    unit: "mm",
                    format: "a4"
                });
                
                // Colors
                const primaryColor = document.body.classList.contains('dark-mode') ? "#4db8a7" : "#007a6c";
                const secondaryColor = document.body.classList.contains('dark-mode') ? "#666" : "#4a4a4a";
                const accentColor = document.body.classList.contains('dark-mode') ? "#ff9800" : "#e57200";
                
                // Font sizes
                const titleSize = 18;
                const sectionTitleSize = 14;
                const subHeadingSize = 12;
                const bodyTextSize = 10;
                const smallTextSize = 8;
                
                // Margins and spacing
                const margin = 15;
                const lineHeight = 5; // Reduced from 6 for better density
                const paragraphSpacing = 3; // Space between paragraphs
                let yPos = margin;
                
                // Page dimensions
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                const textWidth = pageWidth - (2 * margin) - 5; // 5mm safety margin
                
                // Add header (now with better vertical positioning)
                const addHeader = (pageNum, totalPages) => {
                    doc.setFontSize(smallTextSize);
                    doc.setTextColor(secondaryColor);
                    doc.text(`Biosecurity Risk Assessment Report - Page ${pageNum} of ${totalPages}`, 
                        pageWidth - margin, margin - 5, { align: "right" }); // Moved up slightly
                };
                
                // Add footer (now with better vertical positioning)
                const addFooter = () => {
                    doc.setFontSize(smallTextSize);
                    doc.setTextColor(secondaryColor);
                    doc.text("Produced with Biosecurity Risk Assessment Tool", 
                        margin, pageHeight - 10);
                    doc.text(`Generated on ${new Date().toLocaleDateString()}`, 
                        pageWidth - margin, pageHeight - 10, { align: "right" });
                    
                    // Add a subtle divider line
                    doc.setDrawColor(200, 200, 200);
                    doc.line(margin, pageHeight - 15, pageWidth - margin, pageHeight - 15);
                };

                // Improved text writing function with better overflow handling
                const writeText = (text, x, y, options = {}) => {
                    const { maxWidth = textWidth, fontSize = bodyTextSize, fontStyle = 'normal', color = secondaryColor } = options;
                    
                    doc.setFontSize(fontSize);
                    doc.setTextColor(color);
                    doc.setFont("helvetica", fontStyle);
                    
                    const lines = doc.splitTextToSize(text, maxWidth);
                    let currentY = y;
                    
                    for (let i = 0; i < lines.length; i++) {
                        // Check if we need a new page
                        if (currentY > pageHeight - margin - 10) {
                            doc.addPage();
                            addHeader(doc.internal.getNumberOfPages(), 0);
                            addFooter();
                            currentY = margin;
                        }
                        
                        doc.text(lines[i], x, currentY);
                        currentY += lineHeight;
                    }
                    
                    return currentY;
                };
                
                // Add title page
                doc.setFontSize(titleSize);
                doc.setTextColor(primaryColor);
                doc.setFont("helvetica", "bold");
                doc.text("Biosecurity Risk Assessment Report", pageWidth / 2, 40, { align: "center" });
                
                doc.setFontSize(sectionTitleSize);
                doc.setTextColor(secondaryColor); // Changed to secondary color for consistency
                doc.setFont("helvetica", "normal");
                
                const projectName = document.getElementById("project-name").value || "Unnamed Project";
                doc.text(`Project: ${projectName}`, pageWidth / 2, 60, { align: "center" });
                
                const assessorName = document.getElementById("assessor-name").value || "Unassigned";
                doc.text(`Assessor: ${assessorName}`, pageWidth / 2, 70, { align: "center" });
                
                const assessmentDate = document.getElementById("date").value || new Date().toISOString().slice(0,10);
                doc.text(`Date: ${assessmentDate}`, pageWidth / 2, 80, { align: "center" });
                
                // Add location information
                const location = document.getElementById("location").value || "Location not specified";
                doc.text(`Location: ${location}`, pageWidth / 2, 90, { align: "center" });
                
                // Add coordinates
                doc.text(`Coordinates: ${currentLatLng.lat.toFixed(6)}, ${currentLatLng.lng.toFixed(6)}`, pageWidth / 2, 100, { align: "center" });
                
                // Add risk summary
                doc.setFontSize(sectionTitleSize);
                doc.setTextColor(primaryColor);
                doc.text("Risk Summary", pageWidth / 2, 110, { align: "center" });
                
                const riskScore = document.getElementById("risk-score").textContent || "0";
                const riskLevel = document.getElementById("risk-level").textContent || "Low Risk";
                
                // Draw risk meter
                const scoreWidth = (pageWidth - 2 * margin) * (parseInt(riskScore) / 100);
                doc.setFillColor(primaryColor);
                doc.rect(margin, 120, scoreWidth, 8, "F");
                
                doc.setDrawColor(secondaryColor);
                doc.rect(margin, 120, pageWidth - 2 * margin, 8);
                
                doc.setFontSize(bodyTextSize);
                doc.setTextColor(secondaryColor); // Changed to secondary color for consistency
                doc.text(`Risk Score: ${riskScore} (${riskLevel})`, margin, 135);
                
                // Add Project Details page with improved text handling
                doc.addPage();
                yPos = margin;
                addHeader(2, 0);
                addFooter();
                
                yPos = writeText("1. Project Details", margin, yPos, {
                    fontSize: sectionTitleSize,
                    color: primaryColor,
                    fontStyle: 'bold'
                }) + lineHeight * 2;
                
                const projectFields = [
                    { label: "Project Name", value: document.getElementById("project-name").value || "N/A" },
                    { label: "Location", value: document.getElementById("location").value || "N/A" },
                    { label: "Coordinates", value: `${currentLatLng.lat.toFixed(6)}, ${currentLatLng.lng.toFixed(6)}` },
                    { label: "Assessor", value: document.getElementById("assessor-name").value || "N/A" },
                    { label: "Date", value: document.getElementById("date").value || "N/A" },
                    { label: "Description", value: document.getElementById("project-description").value || "N/A" },
                    { label: "Purpose", value: document.getElementById("project-purpose").value || "N/A" }
                ];
                
                projectFields.forEach(field => {
                    // Write label
                    yPos = writeText(`${field.label}:`, margin, yPos, {
                        fontSize: subHeadingSize,
                        fontStyle: 'bold'
                    });
                    
                    // Write value with proper wrapping
                    yPos = writeText(field.value, margin + 5, yPos) + paragraphSpacing;
                });

                // Add Site Information page with improved layout
                doc.addPage();
                yPos = margin;
                addHeader(3, 0);
                addFooter();
                
                yPos = writeText("2. Site Information", margin, yPos, {
                    fontSize: sectionTitleSize,
                    color: primaryColor,
                    fontStyle: 'bold'
                }) + lineHeight * 2;
                
                const siteFields = [
                    { label: "Flora & Fauna", value: document.getElementById("flora-fauna").value || "N/A" },
                    { label: "Environmental Features", 
                      value: Array.from(document.getElementById("environmental-features").selectedOptions)
                          .map(option => option.value).join(", ") || "N/A" },
                    { label: "Distance to Sensitive Ecosystems (km)", 
                      value: document.getElementById("distance-ecosystem").value || "N/A" },
                    { label: "Distance to Critical Infrastructure (km)", 
                      value: document.getElementById("distance-infrastructure").value || "N/A" },
                    { label: "Land Use History", 
                      value: document.getElementById("land-use-history").value || "N/A" },
                    { label: "Current Site Activities", 
                      value: document.getElementById("current-activities").value || "N/A" },
                    { label: "Site Accessibility", 
                      value: document.getElementById("accessibility").value || "N/A" },
                    { label: "Site Notes", 
                      value: document.getElementById("site-notes").value || "N/A" }
                ];
                
                siteFields.forEach(field => {
                    // Write label
                    yPos = writeText(`${field.label}:`, margin, yPos, {
                        fontSize: subHeadingSize,
                        fontStyle: 'bold'
                    });
                    
                    // Write value with proper wrapping
                    yPos = writeText(field.value, margin + 5, yPos) + paragraphSpacing;
                });

                // Add Map to PDF
                if (map) {
                    try {
                        // Convert map to image
                        const mapContainer = document.getElementById('map');
                        const mapImage = await htmlToCanvasPromise(mapContainer);
                        
                        // Add to PDF
                        doc.addPage();
                        yPos = margin;
                        addHeader(doc.internal.getNumberOfPages(), 0);
                        addFooter();
                        
                        doc.setFontSize(sectionTitleSize);
                        doc.setTextColor(primaryColor);
                        doc.text("Project Location Map", margin, yPos);
                        yPos += lineHeight * 2;
                        
                        const mapWidth = pageWidth - 2 * margin;
                        const mapHeight = (mapContainer.offsetHeight / mapContainer.offsetWidth) * mapWidth;
                        doc.addImage(mapImage, 'PNG', margin, yPos, mapWidth, mapHeight);
                        yPos += mapHeight + lineHeight;
                        
                        // Add coordinates
                        doc.setFontSize(bodyTextSize);
                        doc.setTextColor(secondaryColor);
                        doc.text(`Coordinates: ${currentLatLng.lat.toFixed(6)}, ${currentLatLng.lng.toFixed(6)}`, margin, yPos);
                        yPos += lineHeight;
                        
                        // Add location description if available
                        const location = document.getElementById("location").value;
                        if (location) {
                            doc.text(`Location: ${location}`, margin, yPos);
                            yPos += lineHeight;
                        }
                    } catch (e) {
                        console.error("Error adding map to PDF:", e);
                    }
                }

                // Add Photos to PDF
                const photoSections = [
                    { id: 'photo-preview', title: 'Project Photos' },
                    { id: 'photo-preview-site', title: 'Site Photos' },
                    { id: 'photo-preview-risk', title: 'Risk Evidence Photos' }
                ];
                
                for (const section of photoSections) {
                    const photoPreview = document.getElementById(section.id);
                    if (photoPreview && photoPreview.children.length > 0) {
                        doc.addPage();
                        yPos = margin;
                        addHeader(doc.internal.getNumberOfPages(), 0);
                        addFooter();
                        
                        doc.setFontSize(sectionTitleSize);
                        doc.setTextColor(primaryColor);
                        doc.text(section.title, margin, yPos);
                        yPos += lineHeight * 2;
                        
                        const photos = Array.from(photoPreview.querySelectorAll('img'));
                        const photoWidth = (pageWidth - 2 * margin - 10) / 2; // 2 photos per row
                        const photoHeight = photoWidth * 0.75; // 4:3 aspect ratio
                        
                        for (let i = 0; i < photos.length; i++) {
                            // Check if we need a new page (4 photos per page)
                            if (i > 0 && i % 4 === 0) {
                                doc.addPage();
                                yPos = margin;
                                addHeader(doc.internal.getNumberOfPages(), 0);
                                addFooter();
                                doc.setFontSize(sectionTitleSize);
                                doc.setTextColor(primaryColor);
                                doc.text(`${section.title} (continued)`, margin, yPos);
                                yPos += lineHeight * 2;
                            }
                            
                            const xPos = margin + (i % 2) * (photoWidth + 10);
                            const currentY = yPos + Math.floor(i / 2) % 2 * (photoHeight + 10);
                            
                            try {
                                doc.addImage(photos[i].src, 'JPEG', xPos, currentY, photoWidth, photoHeight);
                            } catch (e) {
                                console.error("Error adding photo to PDF:", e);
                            }
                        }
                    }
                }

                // Add Risk Assessment page with improved table layout
                doc.addPage();
                yPos = margin;
                addHeader(doc.internal.getNumberOfPages(), 0);
                addFooter();
                
                yPos = writeText("3. Risk Assessment", margin, yPos, {
                    fontSize: sectionTitleSize,
                    color: primaryColor,
                    fontStyle: 'bold'
                }) + lineHeight * 2;
                
                // Risk metrics table with better column alignment
                const riskMetrics = [
                    { label: "Invasive Species Risk", value: document.getElementById("invasive-species").value || "0" },
                    { label: "Pathogen Spread Risk", value: document.getElementById("pathogen-spread").value || "0" },
                    { label: "Contamination Risk", value: document.getElementById("contamination").value || "0" },
                    { label: "Transportation Risk", value: document.getElementById("transportation").value || "0" },
                    { label: "Quarantine Breach Risk", value: document.getElementById("quarantine-breach").value || "0" },
                    { label: "Training Compliance", value: document.getElementById("training-compliance").value || "0" },
                    { label: "Supply Chain Risk", value: document.getElementById("supply-chain").value || "0" },
                    { label: "Risk Notes", value: document.getElementById("risk-notes").value || "N/A" }
                ];
                
                // Table header
                doc.setFontSize(subHeadingSize);
                doc.setFont("helvetica", "bold");
                doc.setTextColor(secondaryColor);
                doc.text("Risk Factor", margin, yPos);
                doc.text("Score", pageWidth - margin - 15, yPos, { align: "right" });
                yPos += lineHeight;
                
                // Divider line
                doc.setDrawColor(secondaryColor);
                doc.line(margin, yPos, pageWidth - margin, yPos);
                yPos += lineHeight;
                
                // Table rows
                doc.setFontSize(bodyTextSize);
                doc.setFont("helvetica", "normal");
                riskMetrics.forEach(metric => {
                    if (yPos > pageHeight - margin - 10) {
                        doc.addPage();
                        addHeader(doc.internal.getNumberOfPages(), 0);
                        addFooter();
                        yPos = margin;
                    }
                    
                    // Write metric label with proper wrapping
                    const labelLines = doc.splitTextToSize(metric.label, textWidth - 30);
                    doc.text(labelLines, margin, yPos);
                    
                    // Write score aligned to right
                    doc.text(metric.value, pageWidth - margin - 15, yPos + ((labelLines.length - 1) * lineHeight), { align: "right" });
                    
                    yPos += (labelLines.length * lineHeight) + 2;
                });
                
                // Add radar chart with better positioning
                const chartCanvas = document.getElementById("impact-chart");
                if (chartCanvas) {
                    yPos += lineHeight; // Add some space before the chart
                    
                    if (yPos > pageHeight - 100) {
                        doc.addPage();
                        addHeader(doc.internal.getNumberOfPages(), 0);
                        addFooter();
                        yPos = margin;
                    }
                    
                    const chartImage = chartCanvas.toDataURL("image/png");
                    const chartWidth = 150;
                    const chartHeight = (chartCanvas.height / chartCanvas.width) * chartWidth;
                    
                    doc.addImage(chartImage, "PNG", (pageWidth - chartWidth) / 2, yPos, chartWidth, chartHeight);
                    yPos += chartHeight + lineHeight;
                }
                
                // Add heat map visualization
                const heatMapContainer = document.getElementById("heat-map");
                if (heatMapContainer) {
                    yPos += lineHeight;
                    
                    if (yPos > pageHeight - 100) {
                        doc.addPage();
                        addHeader(doc.internal.getNumberOfPages(), 0);
                        addFooter();
                        yPos = margin;
                    }
                    
                    doc.setFontSize(sectionTitleSize);
                    doc.setTextColor(primaryColor);
                    doc.text("Risk Heat Map", margin, yPos);
                    yPos += lineHeight * 2;
                    
                    try {
                        const heatMapImage = await htmlToCanvasPromise(heatMapContainer);
                        const heatMapWidth = pageWidth - 2 * margin;
                        const heatMapHeight = (heatMapContainer.offsetHeight / heatMapContainer.offsetWidth) * heatMapWidth;
                        
                        doc.addImage(heatMapImage, "PNG", margin, yPos, heatMapWidth, heatMapHeight);
                        yPos += heatMapHeight + lineHeight;
                    } catch (e) {
                        console.error("Error adding heat map to PDF:", e);
                    }
                }
                
                // Add Recommendations page
                doc.addPage();
                yPos = margin;
                
                doc.setFontSize(sectionTitleSize);
                doc.setTextColor(primaryColor);
                doc.text("4. Recommendations", margin, yPos);
                yPos += lineHeight * 2;
                
                const recommendationsContainer = document.getElementById("recommendations");
                if (recommendationsContainer) {
                    const recommendations = Array.from(recommendationsContainer.querySelectorAll("li")).map(li => li.textContent);
                    
                    if (recommendations.length > 0) {
                        doc.setFontSize(subHeadingSize);
                        doc.setTextColor(secondaryColor);
                        doc.text("Key Recommendations:", margin, yPos);
                        yPos += lineHeight * 1.5;
                        
                        doc.setFontSize(bodyTextSize);
                        recommendations.forEach((rec, index) => {
                            if (yPos > pageHeight - margin - 20) {
                                doc.addPage();
                                yPos = margin;
                            }
                            
                            // Split long recommendations into multiple lines
                            const lines = doc.splitTextToSize(`${index + 1}. ${rec}`, pageWidth - 2 * margin - 10);
                            lines.forEach(line => {
                                if (yPos > pageHeight - margin - 20) {
                                    doc.addPage();
                                    yPos = margin;
                                }
                                doc.text(line, margin, yPos);
                                yPos += lineHeight * 1.5;
                            });
                        });
                    } else {
                        doc.setFontSize(bodyTextSize);
                        doc.text("No significant risks detected. Regular monitoring recommended.", margin, yPos);
                        yPos += lineHeight;
                    }
                }
                
                // Add Results Notes if they exist
                const resultsNotes = document.getElementById("results-notes").value;
                if (resultsNotes) {
                    doc.addPage();
                    yPos = margin;
                    addHeader(doc.internal.getNumberOfPages(), 0);
                    addFooter();
                    
                    doc.setFontSize(sectionTitleSize);
                    doc.setTextColor(primaryColor);
                    doc.text("5. Assessment Notes", margin, yPos);
                    yPos += lineHeight * 2;
                    
                    yPos = writeText(resultsNotes, margin, yPos);
                }
                
                // Add headers and footers to all pages
                const finalPageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= finalPageCount; i++) {
                    doc.setPage(i);
                    addHeader(i, finalPageCount);
                    addFooter();
                }
                
               // Save the PDF with the final name
                doc.save(`${finalPdfName}.pdf`);
            } catch (error) {
                alert("An error occurred during PDF generation: " + error.message);
                console.error(error);
            }
        }

        // Helper function for converting HTML to canvas
        function htmlToCanvasPromise(element) {
            return new Promise((resolve) => {
                html2canvas(element).then(canvas => {
                    resolve(canvas.toDataURL('image/png'));
                });
            });
        }

        function clearAllData() {
            if (confirm("Are you sure you want to delete all data? This action cannot be undone.")) {
                // Clear form inputs
                document.querySelectorAll("input[type='text'], input[type='date'], input[type='number'], textarea").forEach(input => {
                    input.value = "";
                });
                
                // Reset select elements
                document.querySelectorAll("select").forEach(select => {
                    if (select.multiple) {
                        Array.from(select.options).forEach(option => {
                            option.selected = false;
                        });
                    } else {
                        select.selectedIndex = 0;
                    }
                });
                
                // Reset sliders
                document.querySelectorAll("input[type='range']").forEach(slider => {
                    slider.value = 0;
                    slider.dispatchEvent(new Event('input'));
                });
                
                // Reset map
                currentLatLng = { lat: 0, lng: 0 };
                updateMapMarker(currentLatLng);
                updateLocationInput(currentLatLng);
                
                // Clear photo previews
                document.querySelectorAll('.photo-preview-container').forEach(container => {
                    container.innerHTML = '';
                });
                
                // Clear local storage
                localStorage.removeItem('biosecurityAssessmentData');
                
                // Reset to first section
                showSection(0);
                
                alert("All data has been cleared. Starting a new assessment.");
                
                hasUnsavedChanges = false;
            }
        }

        function startNewAssessment() {
            if (hasUnsavedChanges) {
                showConfirmationDialog(() => {
                    saveDataToLocalStorage();
                    clearAllData();
                });
            } else {
                clearAllData();
            }
        }

        // Modal Functions
        function setupModals() {
            // Get all modal elements
            const modals = {
                privacy: document.getElementById("privacy-modal"),
                terms: document.getElementById("terms-modal"),
                contact: document.getElementById("contact-modal"),
                welcome: document.getElementById("welcome-modal"),
                confirmation: document.getElementById("confirmation-dialog")
            };
            
            // Get all buttons that open modals
            const buttons = {
                privacy: document.getElementById("privacy-policy"),
                terms: document.getElementById("terms-of-use"),
                contact: document.getElementById("contact-support"),
                start: document.getElementById("start-assessment"),
                tutorial: document.getElementById("view-tutorial")
            };
            
            // Get all close buttons
            const closeButtons = document.getElementsByClassName("close-modal");
            
            // Set up click handlers for each modal button
            buttons.privacy.onclick = function() {
                modals.privacy.style.display = "block";
            }
            
            buttons.terms.onclick = function() {
                modals.terms.style.display = "block";
            }
            
            buttons.contact.onclick = function() {
                modals.contact.style.display = "block";
            }
            
            buttons.start.onclick = function() {
                modals.welcome.style.display = "none";
            }
            
            buttons.tutorial.onclick = function() {
                alert("Tutorial video will open in a new window.");
                // In a real implementation, you would open a tutorial video or page
            }
            
            // Set up close handlers for all modals
            Array.from(closeButtons).forEach(button => {
                button.onclick = function() {
                    Object.values(modals).forEach(modal => {
                        modal.style.display = "none";
                    });
                }
            });
            
            // Close modal when clicking outside
            window.onclick = function(event) {
                Object.values(modals).forEach(modal => {
                    if (event.target == modal) {
                        modal.style.display = "none";
                    }
                });
            }
            
            // Confirmation dialog buttons
            document.getElementById("confirm-cancel").addEventListener("click", function() {
                modals.confirmation.style.display = "none";
            });
            
            document.getElementById("confirm-leave").addEventListener("click", function() {
                modals.confirmation.style.display = "none";
                if (window.pendingNavigationAction) {
                    window.pendingNavigationAction();
                    window.pendingNavigationAction = null;
                }
            });
        }

        function showConfirmationDialog(callback) {
            const dialog = document.getElementById("confirmation-dialog");
            dialog.style.display = "block";
            
            // Store the callback for when user confirms
            window.pendingNavigationAction = callback;
        }

        // Track form changes for unsaved changes detection
        function trackFormChanges() {
            const formElements = document.querySelectorAll("input, textarea, select");
            
            formElements.forEach(element => {
                // Skip file inputs and buttons
                if (element.type === 'file' || element.type === 'button' || element.type === 'submit') {
                    return;
                }
                
                element.addEventListener('change', function() {
                    if (!isInitialLoad) {
                        markAsChanged();
                    }
                });
                
                // For text inputs, also track keyup events
                if (element.type === 'text' || element.tagName === 'TEXTAREA') {
                    element.addEventListener('keyup', function() {
                        if (!isInitialLoad) {
                            markAsChanged();
                        }
                    });
                }
            });
            
            // After initial load, set flag to false
            setTimeout(() => {
                isInitialLoad = false;
            }, 1000);
        }
        
        function markAsChanged() {
            if (!isInitialLoad) {
                hasUnsavedChanges = true;
            }
        }

        // Event Listeners
        function setupEventListeners() {
            // Form input auto-save
            document.querySelectorAll("input, textarea, select").forEach(element => {
                element.addEventListener("change", function() {
                    if (!isInitialLoad) {
                        markAsChanged();
                    }
                });
            });
            
            // Save progress buttons
            document.querySelectorAll(".save-progress-button").forEach(button => {
                button.addEventListener("click", saveDataToLocalStorage);
            });
            
            // Sliders
            setupSliderListeners();
            
            // Scenario modeling
            setupScenarioModeling();
            
            // Action buttons
            document.getElementById("generate-report").addEventListener("click", generatePDFReport);
            document.getElementById("save-local").addEventListener("click", saveDataToCSV);
            document.getElementById("delete-data").addEventListener("click", clearAllData);
            document.getElementById("new-assessment").addEventListener("click", startNewAssessment);
            
            // Location buttons
            document.getElementById("get-location-btn").addEventListener("click", getCurrentLocation);
            document.getElementById("search-location-btn").addEventListener("click", searchLocation);
            
            // Footer links
            setupModals();
            
            // Beforeunload event for unsaved changes
            window.addEventListener('beforeunload', function(e) {
                if (hasUnsavedChanges) {
                    e.preventDefault();
                    e.returnValue = 'You have unsaved changes. Are you sure you want to leave?';
                    return e.returnValue;
                }
            });
            
            // Navigation buttons with confirmation
            document.querySelectorAll(".next-button, .prev-button").forEach(button => {
                button.addEventListener("click", function() {
                    if (hasUnsavedChanges) {
                        const originalAction = this.getAttribute("onclick");
                        showConfirmationDialog(function() {
                            eval(originalAction);
                        });
                        return false;
                    }
                });
            });
        }
    </script>
</body>
    </html>
